{"version":3,"sources":["views/article/reactions/icons.tsx","views/article/reactions/index.tsx","views/article/comment/index.tsx","components/tip-select/index.tsx","views/article/interact.tsx","views/article/comment/style.module.scss","views/article/reactions/style.module.scss","components/tip-select/style.module.scss"],"names":["Clap","witchParentClass","width","height","viewBox","aria-label","fillRule","d","Comment","View","version","xmlns","p-id","type","More","data-view-component","iconMaps","icons","ReactionItem","Icon","children","props","className","style","reaction","isActive","active","onClick","count","ReactionItems","treaction","Array","isArray","data","reactions","defaultEnableds","userInfo","forEach","key","item","content","user","id","owner","userId","transformReactions","Object","keys","reduce","t","k","items","filter","includes","map","onIncrement","requestsIng","ReactionServeFactory","delApi","allApi","addApi","paths","namespace","useGlobalState","axios","get","setReactions","updateReaction","model","promise","oReaction","delete","reactionId","temporary","created_at","Date","toISOString","concat","request","url","method","then","addReaction","catch","auth","modeEnum","Tip","parent","document","documentElement","target","getPostionByTarget","x","y","createPortal","left","top","Select","options","onSelect","option","warn","label","value","TipSelect","body","React","placeDOM","setPlaceDOM","showSelect","setShowSelect","isUninstall","clickHandler","setTimeout","addEventListener","removeEventListener","place","ev","stopPropagation","ref","el","ChatBox","head","avatar","href","html_url","rel","src","avatar_url","alt","login","modeDesc","EDIT","VIEW","CommitInput","onChange","forwardRef","editRef","currMode","setCurrMode","simplemde","setSimplemde","lemde","SimpleMDE","element","current","spellChecker","status","initialValue","toolbar","previewRender","mdtext","analysisMarked","toTextArea","lines","split","codemirror","focus","setCursor","length","simpleLastFocus","mode","Number","isPreviewActive","tabChange","on","btns","CommentItem","setBody","currentUser","config","commentReactions","commentReaction","ReactSimleFactory","oper","time","formatDate","onOper","dangerouslySetInnerHTML","__html","nbody","disabled","Comments","comments","edits","marker","args","initReactionSimples","ArticleReactions","comment","gotoComment","commoent","view","JoinColumns","to","queryRoutePath","title","Interact","issuesId","issues","number","undefined","setUserInfo","isLocalAuth","isAuth","setComments","editComments","setEditComments","articleReactions","articleReaction","editTxt","setEditTxt","editLoadRef","column","section","startLoading","post","stopLoading","submitComment","unauth","getAuthLink","commentOper","join","fc","commentId","window","confirm","module","exports"],"mappings":"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","file":"static/js/4.fbd72a16.chunk.js","sourcesContent":["import * as React from \"react\";\nimport { witchParentClass } from \"src/hoc\";\n\n\nexport const Clap = witchParentClass(() => <svg width=\"29\" height=\"29\" viewBox=\"0 0 29 29\" aria-label=\"clap\"><g fillRule=\"evenodd\"><path d=\"M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z\"></path></g></svg>)\nexport const Comment = witchParentClass(() => <svg width=\"29\" height=\"29\" viewBox=\"0 0 29 29\" aria-label=\"responses\" ><path d=\"M21.27 20.06a9.04 9.04 0 0 0 2.75-6.68C24.02 8.21 19.67 4 14.1 4S4 8.21 4 13.38c0 5.18 4.53 9.39 10.1 9.39 1 0 2-.14 2.95-.41.28.25.6.49.92.7a7.46 7.46 0 0 0 4.19 1.3c.27 0 .5-.13.6-.35a.63.63 0 0 0-.05-.65 8.08 8.08 0 0 1-1.29-2.58 5.42 5.42 0 0 1-.15-.75zm-3.85 1.32l-.08-.28-.4.12a9.72 9.72 0 0 1-2.84.43c-4.96 0-9-3.71-9-8.27 0-4.55 4.04-8.26 9-8.26 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32a5.59 5.59 0 0 0 .21 1.29c.19.7.49 1.4.89 2.08a6.43 6.43 0 0 1-2.67-1.06c-.34-.22-.88-.48-1.16-.74z\"></path></svg>)\nexport const View = witchParentClass(() => <svg  viewBox=\"0 0 1143 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"16296\" width=\"29\" height=\"29\"><defs><style type=\"text/css\"></style></defs><path d=\"M560.35 796.723c-121.769 0-218.468-100.281-218.468-225.631s96.699-225.631 218.468-225.631c121.769 0 218.468 100.281 218.468 225.631s-96.699 225.631-218.468 225.631zM560.35 381.277c-100.281 0-182.652 85.954-182.652 189.815s82.373 189.815 182.652 189.815c100.281 0 182.652-85.954 182.652-189.815 0-103.861-82.373-189.815-182.652-189.815z\" p-id=\"16297\"></path><path d=\"M560.35 674.955c-53.722 0-100.281-46.559-100.281-103.861s46.559-103.861 100.281-103.861 100.281 46.559 100.281 103.861-42.977 103.861-100.281 103.861zM560.35 503.045c-35.813 0-64.465 28.652-64.465 68.047 0 35.813 28.652 68.047 64.465 68.047s64.465-28.652 64.465-68.047c0-35.813-28.652-68.047-64.465-68.047z\" p-id=\"16298\"></path><path d=\"M560.35 932.818c-214.886 0-411.865-136.094-519.307-354.562-3.582-3.582-3.582-10.745 0-14.325 107.442-218.468 308.003-354.562 519.307-354.562 214.886 0 411.865 136.094 519.307 354.562 3.582 3.582 3.582 10.745 0 14.325-103.861 218.468-304.421 354.562-519.307 354.562zM76.855 571.094c103.861 200.56 286.515 325.91 483.493 325.91s383.214-125.35 483.493-325.91c-103.861-200.56-286.515-325.91-483.493-325.91s-383.214 125.35-483.493 325.91z\" p-id=\"16299\"></path></svg>)\n\nexport const More = witchParentClass(() => <svg height=\"16\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" data-view-component=\"true\"><path d=\"M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z\"></path></svg>)","import * as React from \"react\"\nimport { witchParentClass } from \"src/hoc\"\nimport * as icons from './icons'\nimport style from './style.module.scss'\nimport { useGlobalState } from \"src/state\"\nimport {\n  axios, \n  Reactions, \n  UserInfo, \n  ReactionContent, \n  config,\n  ReactionSimples,\n  Reaction\n} from \"src/request\"\nimport { auth } from \"src/github\"\n\ntype TReactionInfo = {\n  userId: number,\n  id: number\n}\ntype TReaction = {\n  [key in ReactionContent]: {\n    count: number,\n    owner?: TReactionInfo\n  }\n}\n\nexport const iconMaps: {\n  [key in ReactionContent | 'commoent' | 'view']: typeof icons.Clap\n} = {\n  '+1': icons.Clap,\n  '-1': icons.Clap,\n  'commoent': icons.Comment,\n  'view': icons.View,\n  \"laugh\": icons.Clap,\n  \"confused\": icons.Clap,\n  \"heart\": icons.Clap,\n  \"hooray\": icons.Clap,\n  \"rocket\": icons.Clap,\n  \"eyes\": icons.Clap\n}\n\n\nexport type TransformReactionsArgs = {\n  reactions: Reactions,\n  defaultEnableds?: Array<ReactionContent>,\n  userInfo?: UserInfo, \n}\nfunction transformReactions({\n  reactions,\n  defaultEnableds = [],\n  userInfo, \n}: TransformReactionsArgs) {\n  const treaction = {} as TReaction\n\n  defaultEnableds.forEach(key => {\n    treaction[key] = { count: 0 }\n  })\n\n  for (let item of reactions) {\n    if (!treaction[item.content]) {\n      treaction[item.content] = { count: 0 }\n    }\n\n    if (userInfo && item.user.id === userInfo.id) {\n      treaction[item.content].owner = {\n        userId: userInfo.id,\n        id: item.id\n      }\n    }\n\n    treaction[item.content].count++\n  }\n\n  return treaction\n}\n\n\ntype SupportType = keyof typeof iconMaps\ntype ReactionProps<T extends SupportType> = {\n  count: number,\n  isActive: boolean,\n  children: (typeof iconMaps)[T],\n  onClick?: () => void\n}\nexport const ReactionItem = witchParentClass(\n  <T extends SupportType> ({children: Icon, ...props}: ReactionProps<T>) =>\n    <span\n      className={`${style.reaction} ${props.isActive ? style.active: ''}`} \n      { \n        ...props.onClick \n          ? { onClick: () => props.onClick!() }\n          : { }\n      }\n    >\n      { Icon({}) }\n      { props.count }\n    </span>\n)\n\nexport type onIncrement = (\n  key: ReactionContent, \n  info?: TReactionInfo\n) => void\n\nexport const ReactionItems = witchParentClass(\n  (\n    props: { \n      data: Reactions | ReactionSimples,\n      userInfo?: UserInfo,\n      onIncrement?: onIncrement,\n      defaultEnableds?: TransformReactionsArgs['defaultEnableds']\n    }\n  ) => {\n    const treaction = Array.isArray(props.data)\n      ? transformReactions({ \n        reactions: props.data, \n        userInfo: props.userInfo,\n        defaultEnableds: props.defaultEnableds\n      })\n      : Object.keys(props.data).reduce(\n        (t, k) => ({\n          ...t,\n          [k]: { count: (props.data as ReactionSimples)[k as ReactionContent] }\n        }),\n        {} as TReaction\n      )\n    const items = (Object.keys(treaction) as Array<keyof typeof treaction>)\n      .filter(\n        key => iconMaps[key] && (\n            treaction[key].count > 0 || \n            props.defaultEnableds?.includes(key)\n          )\n      )\n      .map(key => (\n        <ReactionItem \n          key={key}\n          count={treaction[key].count}\n          isActive={!!treaction[key].owner}\n          {\n            ...props.onIncrement \n              ? { onClick: () => props.onIncrement!(key, treaction[key].owner) }\n              : {}\n          }>\n          {iconMaps[key]}\n        </ReactionItem>\n      ))\n      \n    return <React.Fragment>{items}</React.Fragment>\n  }\n)\n\ntype URL = typeof config\nexport type ReactionOperProp = {\n  delApi?: URL['articleReaction'] | URL['commentReaction'],\n  addApi?: URL['articleReactions'] | URL['commentReactions'],\n  allApi: URL['articleReactions'] | URL['commentReactions'],\n  paths: { id: any }\n  namespace: string,\n  user?: UserInfo\n}\n\nexport type UpdateReaction = (content: ReactionContent, model?: TReactionInfo) => void\n\nconst requestsIng: { [key in string]: boolean } = { }\nexport function ReactionServeFactory(\n  config: Required<ReactionOperProp>\n    | Omit<Required<ReactionOperProp>, 'addApi' | 'user'>\n    | Omit<Required<ReactionOperProp>, 'delApi' | 'user'>\n): [Reactions, UpdateReaction]\nexport function ReactionServeFactory(\n  config: Omit<ReactionOperProp, 'delApi' | 'addApi'>\n): [Reactions]\nexport function ReactionServeFactory({\n  delApi, \n  allApi, \n  addApi, \n  paths,\n  user,\n  namespace = allApi\n}: ReactionOperProp) {\n  const [reactions, setReactions] = useGlobalState(\n    namespace,\n    () => axios.get(allApi, { paths }),\n    []\n  )\n  requestsIng[namespace] = false\n\n  const updateReaction: UpdateReaction = user\n    ? (content, model) => {\n        if (requestsIng[namespace]) return;\n        let promise: Promise<any> | null = null\n\n        requestsIng[namespace] = true\n\n        if (model && delApi) {\n          setReactions(\n            reactions.filter(oReaction => oReaction.id !== model.id)\n          )\n          promise = axios.delete(delApi, {\n            paths: {\n              ...paths,\n              reactionId: model.id\n            }\n          })\n        } else if (!model && addApi) {\n          const temporary: Reaction = {\n            content: content,\n            created_at: new Date().toISOString(),\n            id: 0,\n            user\n          }\n          setReactions(reactions.concat(temporary))\n\n          promise = axios.request({\n            url: addApi,\n            method: 'POST',\n            paths,\n            data: { content }\n          }).then(addReaction => {\n            setReactions(\n              reactions\n                .filter(reaction => reaction !== temporary)\n                .concat(addReaction)\n            )\n          })\n        }\n\n        promise\n          ?.catch(() => setReactions(reactions))\n          .then(() => requestsIng[namespace] = false)\n      }\n    : auth\n\n  return [reactions, updateReaction]\n}\n\nexport const ReactSimleFactory = (reactions: ReactionSimples) => {\n  const [sReactions] = React.useState(reactions)\n\n  return [ sReactions, auth ] as const\n}","import * as React from 'react'\nimport * as SimpleMDE from 'simplemde'\nimport style from './style.module.scss'\nimport { ReactionItems, ReactionServeFactory, ReactSimleFactory } from '../reactions'\nimport { analysisMarked, formatDate } from 'src/util'\nimport { witchParentClass } from 'src/hoc'\nimport { TipSelect } from 'src/components/tip-select'\nimport { More } from '../reactions/icons'\nimport { \n  UserInfo, \n  Comment as CommentType, \n  CommentList,\n  config\n} from 'src/request'\n\ntype UserInfoProps = {\n  userInfo: UserInfo\n}\n\ntype ChatProps = UserInfoProps & {\n  children: any,\n  head: any\n}\nexport const ChatBox = witchParentClass((props: ChatProps) => {\n  return (\n    <div className={style['chat']}>\n      <div className={style.head}>\n        <div className={style.avatar}>\n          <a href={props.userInfo.html_url} target=\"_blank\" rel=\"noreferrer\">\n            <img src={props.userInfo.avatar_url} alt={props.userInfo.login} />\n          </a>\n        </div>\n        {props.head}\n      </div>\n      <div className={style.body}>\n        {props.children}\n      </div>\n    </div>\n  )\n})\n\nenum modeEnum { EDIT, VIEW }\nconst modeDesc = { \n  [modeEnum.EDIT]: '编写', \n  [modeEnum.VIEW]: '预览' \n} as const\n\nexport type InputRef = React.RefObject<{focus: () => void}>\ntype InputProps = UserInfoProps & {\n  forwardRef?: InputRef\n  onChange?: (newValue: string, oldValue: string) => void\n  children?: any,\n  value?: string\n}\n\nconst simpleLastFocus = (simplemde: SimpleMDE) => {\n  const value = simplemde.value()\n  const lines = value.split('\\n')\n  simplemde.codemirror.focus()\n  simplemde.codemirror.setCursor(\n    lines.length,\n    lines[lines.length - 1].length\n  )\n}\n\nexport const CommitInput = witchParentClass(\n  ({ userInfo, onChange, children, value = '', forwardRef }: InputProps) => {\n    const editRef = React.useRef(null)\n    const [currMode, setCurrMode] = React.useState(modeEnum.EDIT)\n    const [simplemde, setSimplemde] = React.useState<SimpleMDE | null>(null)\n    \n    React.useEffect(() => {\n      const lemde = new SimpleMDE({\n        element: editRef.current as unknown as HTMLElement,\n        spellChecker: false,\n        status: false,\n        initialValue: '',\n        toolbar: [\n          'code', 'link', 'image', 'table', '|',\n          'bold', 'italic', 'strikethrough', '|',\n          'heading-1', 'heading-2', 'heading-3', '|',\n          'quote', 'unordered-list', 'ordered-list', 'horizontal-rule', '|',\n          'fullscreen', 'guide'\n        ],\n        previewRender: (mdtext) =>\n          `<div class=\"marked-body input-marked\">${analysisMarked(mdtext)}</div>`\n      })\n      setSimplemde(lemde)\n\n      return () => {\n        lemde.toTextArea()\n      }\n    }, [editRef])\n\n    React.useEffect(() => {\n      if (simplemde && simplemde.value() !== value) {\n        simplemde.value(value)\n        simpleLastFocus(simplemde)\n      }\n    }, [value, simplemde])\n\n    React.useImperativeHandle(forwardRef, () => ({\n      focus() {\n        simplemde?.codemirror.focus()\n      }\n    }))\n\n    const tabChange = (mode: modeEnum) => {\n      if (!simplemde) return;\n      if ((mode === modeEnum.VIEW && !simplemde.isPreviewActive())\n        || (mode === modeEnum.EDIT && simplemde.isPreviewActive())\n      ) {\n        SimpleMDE.togglePreview(simplemde)\n      }\n      setCurrMode(mode)\n    }\n\n    const head = (\n      <div className={style['mode-tabs']}>\n        {Object.keys(modeDesc).map(mode => (\n          <span \n            key={mode}\n            className={currMode === Number(mode) ? style.active : ''}\n            onClick={() => tabChange(Number(mode))}>\n            {modeDesc[mode as unknown as modeEnum]}\n          </span>\n        ))}\n      </div>\n    )\n\n    if (onChange) {\n      simplemde?.codemirror.on('change', () => {\n        onChange(simplemde.value(), value)\n      })\n    }\n\n    return (\n      <ChatBox userInfo={userInfo} head={head} className={style['md-edit']}>\n        <textarea ref={editRef} className={style['input']}></textarea>\n        <div className={style.btns}>\n          { children }\n        </div>\n      </ChatBox>\n      )\n  }\n)\n\nexport type CommentItemProps = CommentType & {\n  mode: 'ready' | 'write',\n  currentUser?: UserInfo, \n  onOper?: (oper: string, args?: any) => void\n}\nexport const CommentItem = witchParentClass(\n  (props: CommentItemProps) => {\n    const [ body, setBody ] = React.useState(props.body)\n    const [ reactions, onIncrement ] = \n      props.currentUser\n        ? ReactionServeFactory({\n            allApi: config.commentReactions,\n            delApi: config.commentReaction,\n            addApi: config.commentReactions,\n            user: props.currentUser,\n            namespace: `${props.id}/reactions`,\n            paths: { id: props.id }\n          })\n        : ReactSimleFactory(props.reactions)\n\n    const options = [\n      { label: '引用', value: 'quote' },\n      { label: '回复', value: 'reply' },\n      ...props.currentUser?.id === props.user.id\n        ? [\n            { label: '修改', value: 'update' },\n            { label: '删除', value: 'delete', warn: true }\n          ]\n        : []\n    ]\n\n\n    return props.mode === 'ready' \n      ? <ChatBox \n          className={style['commit-item']}\n          userInfo={props.user}\n          head={\n            <React.Fragment>\n              <strong>{props.user.login}</strong>\n              <div className={style.oper}>\n                <span className={style.time}>\n                  评论于{formatDate(new Date(props.created_at))}\n                </span>\n                <TipSelect \n                  options={options} \n                  onSelect={option => props.onOper && props.onOper(option.value)}>\n                  <More />\n                </TipSelect>\n              </div>\n            </React.Fragment>\n          }\n        >\n          <div \n            className='marked-body'\n            dangerouslySetInnerHTML={{__html: analysisMarked(props.body)}} \n          />\n          <div className={style.reactions}>\n            <ReactionItems \n              data={reactions} \n              onIncrement={onIncrement} \n              userInfo={props.currentUser}\n              defaultEnableds={['+1', '-1']}\n            />\n          </div>\n        </ChatBox>\n      : <CommitInput \n          value={body} \n          userInfo={props.currentUser as UserInfo} \n          onChange={nbody => setBody(nbody)}>\n          <button \n            className='primary'\n            {...body ? {} : {disabled: true}} \n            onClick={ () => props.onOper && props.onOper('enterUpdate', body) }>\n            修改\n          </button>\n          <button \n            className='cancel'\n            onClick={() => props.onOper && props.onOper('cacelUpdate')}>\n            取消\n          </button>\n        </CommitInput>\n})\n\nexport type CommentsProps = { \n  comments: CommentList, \n  edits: CommentList,\n  user: UserInfo | undefined,\n  onOper: (marker: string, comment: CommentType, args?: any) => void\n}\nexport const Comments = witchParentClass(\n  ({ comments, user, onOper, edits }: CommentsProps) => (\n    comments.length \n      ? <div>\n          {comments.map(item => \n            <CommentItem \n              {...item}\n              mode={edits.includes(item) ? 'write' : 'ready'}\n              currentUser={user}\n              key={item.id}\n              className={style['commit-item-layer']} \n              onOper={(marker, args) => onOper(marker, item, args)}\n            />\n          )}\n        </div>\n      : <div className={style['un-comments']}>\n          <p>暂无评论</p> \n        </div>\n  )\n)\n\n","import * as React from 'react';\nimport style from './style.module.scss'\nimport { createPortal } from 'react-dom'\nimport { getPostionByTarget } from 'src/util';\n\nexport type TipSelectProps = {\n  children: any\n}\n\nexport type TipProps = {\n  children: any,\n  parent?: HTMLElement,\n  target: HTMLElement\n}\nexport const Tip = ({\n  children,\n  parent = document.documentElement,\n  target\n}: TipProps) => {\n  const { x, y } = getPostionByTarget(target, parent, true)\n  const width = 140\n\n  const selectEle = createPortal(\n    <div \n      className={style['tip-layer']} \n      style={{\n        width: width + 'px',\n        left: x - width + 'px', \n        top: y + 'px'\n      }}>\n      { children }\n    </div>,\n    parent\n  )\n  \n  return selectEle\n}\n\nexport type SelectOption = { \n  label: string, \n  value: string,\n  warn?: boolean\n}\nexport type SelectProps = {\n  options: Array<SelectOption>\n  onSelect?: (option: SelectOption) => void\n}\nexport const Select = ({\n  options,\n  onSelect\n}: SelectProps) => {\n  return (\n    <div className={style['select-layer']}>\n      {options.map(option => \n        <div \n          key={option.value}\n          onClick={() => onSelect && onSelect(option)}\n          className={option.warn ? style['warn'] : ''}>\n          {option.label}\n        </div>\n      )}\n    </div>\n  )\n}\n\nexport const TipSelect = ({\n  children,\n  options,\n  onSelect\n}: TipSelectProps & SelectProps) => {\n  const parent = document.body\n  const [placeDOM, setPlaceDOM] = React.useState<HTMLSpanElement | null>(null)\n  const [showSelect, setShowSelect] = React.useState(false)\n  const placeClickHanlder = (ev: React.MouseEvent<HTMLSpanElement>) => {\n    setShowSelect(true)\n    ev.stopPropagation()\n  }\n\n  React.useEffect(() => {\n    let isUninstall = false\n    const clickHandler = () => {\n      setTimeout(() => {\n        isUninstall || setShowSelect(false)\n      })\n    }\n\n    parent.addEventListener('click', clickHandler)\n    return () => {\n      parent.removeEventListener('click', clickHandler)\n      isUninstall = true\n    }\n  }, [parent])\n\n  return (\n    <React.Fragment>\n      <span \n        className={style.place} \n        onClick={placeClickHanlder} \n        ref={el => setPlaceDOM(el)}>\n          {children}\n      </span>\n      { showSelect && placeDOM\n        ? <Tip parent={parent} target={placeDOM} >\n            <Select options={options} onSelect={onSelect} />\n          </Tip> \n        : null \n      }\n    </React.Fragment>\n  )\n}","import * as React from 'react'\nimport { witchParentClass } from 'src/hoc'\nimport style from './style.module.scss'\nimport { useGlobalState } from 'src/state'\nimport { Link } from 'react-router-dom'\nimport { queryRoutePath } from 'src/router'\nimport { CommitInput, Comments, InputRef } from './comment'\nimport { auth, getAuthLink, isLocalAuth } from 'src/github'\nimport { LoadRef, Loading } from 'src/components/loading'\nimport { LoadEle } from './index'\nimport { \n  ReactionItems, \n  ReactionItem, \n  iconMaps, \n  onIncrement,\n  ReactionServeFactory\n } from './reactions'\n import { \n  UserInfo, \n  Article, \n  Reactions, \n  ReactionContent, \n  ReactionSimples, \n  Comment,\n  axios, \n  config, \n  CommentList\n} from 'src/request'\n\n\ntype ArticleReactionsProps = {\n  \"reactions\"?: Reactions,\n  \"userInfo\"?: UserInfo,\n  \"comment\": number,\n  \"view\": number,\n  \"onIncrement\"?: onIncrement,\n  \"gotoComment\"?: () => void,\n  \"defaultEnableds\"?: Array<ReactionContent>\n}\n\ntype CompoentReactionSimples = Omit<ReactionSimples, 'url'>\n\nconst initReactionSimples: CompoentReactionSimples = {\n  '+1': 0,\n  '-1': 0,\n  'confused': 0,\n  'eyes': 0,\n  'heart': 0,\n  'hooray': 0,\n  'laugh': 0,\n  'rocket': 0\n}\n\nconst ArticleReactions = witchParentClass((props: ArticleReactionsProps) => (\n    <div className={style['article-reactions']}>\n      <div className={style.reactions}>\n        {\n          props.reactions && \n            <ReactionItems \n              data={props.reactions} \n              onIncrement={props.onIncrement} \n              userInfo={props.userInfo}\n              defaultEnableds={props.defaultEnableds}\n            />\n        }\n        <ReactionItem count={props.comment} isActive={false} onClick={props.gotoComment}>\n          {iconMaps.commoent}\n        </ReactionItem>\n        <ReactionItem count={props.view} isActive={false} >\n          {iconMaps.view}\n        </ReactionItem>\n      </div>\n    </div>\n  )\n)\n\nconst JoinColumns = witchParentClass((props: Article['column']) => {\n  return (\n    <div className={style['join-columns']}>\n      <Link to={queryRoutePath('special')}>{props.title}</Link>\n      <Link to={queryRoutePath('special')}>{props.title}</Link>\n    </div>\n  )\n})\n\nexport type InteractProp = {\n  issues: Article['issues'],\n  column: Article['column']\n}\n\nconst Interact = witchParentClass((props: InteractProp) => {\n  const paths = { issuesId: props.issues.number }\n  const [userInfo, setUserInfo] = React.useState<UserInfo | undefined>(undefined)\n  const [isAuth] = React.useState(isLocalAuth())\n  const [comments, setComments] = useGlobalState(\n    `article/comments/${props.issues.number}`,\n    () => axios.get(config.comments, { paths }),\n    null\n  )\n  const [editComments, setEditComments] = React.useState<CommentList>([])\n  const [reactions, onIncrement] = ReactionServeFactory({\n    user: userInfo,\n    allApi: config.articleReactions,\n    delApi: config.articleReaction,\n    addApi: config.articleReactions,\n    namespace: `${props.issues.number}/reactions`,\n    paths: { id:props.issues.number }\n  })\n\n  const [editTxt, setEditTxt] = React.useState('')\n  const editRef: InputRef = React.createRef()\n  const editLoadRef: LoadRef = React.createRef()\n\n  const submitComment = (body: string) => {\n    if (!comments) return;\n\n    editLoadRef.current?.startLoading()\n    axios.post(config.comments, { body }, { paths } )\n      .then(comment => {\n        editLoadRef.current?.stopLoading()\n        setComments([\n          {\n            ...comment,\n            reactions: { ...initReactionSimples, url: '' }\n          },\n          ...comments\n        ])\n        setEditTxt('')\n      })\n  }\n\n  const commentOper = (marker: string, comment: Comment, args?: string) => {\n    if (!userInfo) return auth()\n\n    switch(marker) {\n      case 'quote':\n        setEditTxt(`> ${comment.body.split(/(?:\\n)|(?:\\r\\n)/).join('\\n> ')}\\n\\n`)\n        break;\n      case 'reply':\n        setEditTxt(`@${comment.user.login} `)\n        break;\n      case 'update':\n        setEditComments([...editComments, comment])\n        break;\n      case 'cacelUpdate':\n        setEditComments(editComments.filter(fc => fc !== comment))\n        break;\n      case 'enterUpdate':\n        if (args && comments) {\n          axios.request({\n            url: config.comment,\n            method: 'PATCH',\n            paths: { commentId: comment.id },\n            data: { body: args },\n          })\n          setComments(\n            comments.map(\n              fc => fc === comment\n                ? { ...comment, body: args }\n                : fc\n            )\n          )\n          commentOper('cacelUpdate', comment)\n        }\n        break;\n      case 'delete':\n        if (!window.confirm('确定要删除此评论吗？')) return;\n\n        setComments(\n          (comments as CommentList).filter(fc => fc.id !== comment.id)\n        )\n        axios.delete(\n          config.comment, \n          { paths: { commentId: comment.id } }\n        ).catch(() => setComments(comments))\n        break;\n    }\n  }\n\n  React.useEffect(() => {\n    isAuth &&\n      axios.get(config.userInfo).then(setUserInfo)\n  }, [isAuth])\n\n  return (\n    <div className={style['interact-layer'] + ' ' + style['variable']}>\n      <JoinColumns {...props.column} className={style.section} />\n      <ArticleReactions \n        onIncrement={ onIncrement }\n        className={style.section} \n        reactions={reactions}\n        userInfo={userInfo}\n        comment={comments ? comments.length : 0} \n        gotoComment={ () => userInfo ? editRef.current?.focus() : auth() }\n        defaultEnableds={['+1']}\n        view={8}\n      />\n      <div className={style['boundary']}>\n        {userInfo \n          ? <React.Fragment>\n              <Loading ref={editLoadRef} />\n              <CommitInput \n                forwardRef={editRef}\n                userInfo={userInfo} \n                onChange={setEditTxt} \n                value={editTxt}>\n\n                <button \n                  {...editTxt ? {} : {disabled: true}} \n                  onClick={() => submitComment(editTxt)}\n                  className='primary'>\n                    发表\n                </button>\n              </CommitInput>\n            </React.Fragment>\n          : <div className={style.unauth}>\n              暂未授权登录，<a href={getAuthLink()}>授权跟博主互动</a>\n            </div>\n        }\n      </div>\n      { comments \n        ? <Comments\n          edits={editComments}\n          onOper={commentOper}\n          className={style['boundary']} \n          comments={comments} \n          user={userInfo} \n        />\n        : <LoadEle />\n      }\n    </div>\n  )\n})\n\nexport default Interact","// extracted by mini-css-extract-plugin\nmodule.exports = {\"chat\":\"style_chat__1gl94\",\"head\":\"style_head__c1Be5\",\"avatar\":\"style_avatar__2r7Ru\",\"body\":\"style_body__3Jrjh\",\"commit-item\":\"style_commit-item__9sWax\",\"time\":\"style_time__24MXN\",\"oper\":\"style_oper__oC-KU\",\"reactions\":\"style_reactions__3rNWN\",\"commit-item-layer\":\"style_commit-item-layer__2x_-t\",\"md-edit\":\"style_md-edit__3PSy5\",\"mode-tabs\":\"style_mode-tabs__3RY9T\",\"active\":\"style_active__2s66l\",\"input\":\"style_input__1mejh\",\"btns\":\"style_btns__365tx\",\"un-comments\":\"style_un-comments__3i_64\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"reaction\":\"style_reaction__3y9af\",\"active\":\"style_active__3T7g6\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"place\":\"style_place__1NzD0\",\"tip-layer\":\"style_tip-layer__fsQ3P\",\"select-layer\":\"style_select-layer__3ISCg\",\"warn\":\"style_warn__1F0qN\"};"],"sourceRoot":""}