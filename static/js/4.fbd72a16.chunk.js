(this.webpackJsonpsource=this.webpackJsonpsource||[]).push([[4],{102:function(e,t,c){"use strict";c.r(t);var n=c(2),a=c(46),r=c(3),i=c(1),s=c(13),o=c(60),l=c.n(o),u=c(17),d=c(9),j=c(20),b=c(19),m=c(107),f=c(119),O=c.n(f),h=c(27),v=c(10),p=c(0),x=Object(s.a)((function(){return Object(p.jsx)("svg",{width:"29",height:"29",viewBox:"0 0 29 29","aria-label":"clap",children:Object(p.jsx)("g",{fillRule:"evenodd",children:Object(p.jsx)("path",{d:"M11.74 0l.76 2.97.76-2.97zM14.81 3.78l1.84-2.56-1.42-.47zM8.38 1.22l1.84 2.56L9.8.75zM20.38 21.62a5.11 5.11 0 0 1-3.16 1.61l.49-.45c2.88-2.89 3.45-5.98 1.69-9.21l-1.1-1.94-.96-2.02c-.31-.67-.23-1.18.25-1.55a.84.84 0 0 1 .66-.16c.34.05.66.28.88.6l2.85 5.02c1.18 1.97 1.38 5.12-1.6 8.1M7.1 21.1l-5.02-5.02a1 1 0 0 1 .7-1.7 1 1 0 0 1 .72.3l2.6 2.6a.44.44 0 0 0 .63-.62L4.1 14.04l-1.75-1.75a1 1 0 1 1 1.41-1.41l4.15 4.15a.44.44 0 0 0 .63 0 .44.44 0 0 0 0-.62L4.4 10.26 3.22 9.08a1 1 0 0 1 0-1.4 1.02 1.02 0 0 1 1.41 0l1.18 1.16L9.96 13a.44.44 0 0 0 .62 0 .44.44 0 0 0 0-.63L6.43 8.22a.99.99 0 0 1-.3-.7.99.99 0 0 1 .3-.7 1 1 0 0 1 1.41 0l7 6.98a.44.44 0 0 0 .7-.5l-1.35-2.85c-.31-.68-.23-1.19.25-1.56a.85.85 0 0 1 .66-.16c.34.06.66.28.88.6L18.63 14c1.57 2.88 1.07 5.54-1.55 8.16a5.62 5.62 0 0 1-5.06 1.65 9.35 9.35 0 0 1-4.93-2.72zM11 5.98l2.56 2.56c-.5.6-.56 1.41-.15 2.28l.26.56-4.25-4.25a.98.98 0 0 1-.12-.45 1 1 0 0 1 .29-.7 1.02 1.02 0 0 1 1.41 0zm8.89 2.06c-.38-.56-.9-.92-1.49-1.01a1.74 1.74 0 0 0-1.34.33c-.38.29-.61.65-.71 1.06a2.1 2.1 0 0 0-1.1-.56 1.78 1.78 0 0 0-.99.13l-2.64-2.64a1.88 1.88 0 0 0-2.65 0 1.86 1.86 0 0 0-.48.85 1.89 1.89 0 0 0-2.67-.01 1.87 1.87 0 0 0-.5.9c-.76-.75-2-.75-2.7-.04a1.88 1.88 0 0 0 0 2.66c-.3.12-.61.29-.87.55a1.88 1.88 0 0 0 0 2.66l.62.62a1.88 1.88 0 0 0-.9 3.16l5.01 5.02c1.6 1.6 3.52 2.64 5.4 2.96a7.16 7.16 0 0 0 1.18.1c1.03 0 2-.25 2.9-.7A5.9 5.9 0 0 0 21 22.24c3.34-3.34 3.08-6.93 1.74-9.17l-2.87-5.04z"})})})})),_=Object(s.a)((function(){return Object(p.jsx)("svg",{width:"29",height:"29",viewBox:"0 0 29 29","aria-label":"responses",children:Object(p.jsx)("path",{d:"M21.27 20.06a9.04 9.04 0 0 0 2.75-6.68C24.02 8.21 19.67 4 14.1 4S4 8.21 4 13.38c0 5.18 4.53 9.39 10.1 9.39 1 0 2-.14 2.95-.41.28.25.6.49.92.7a7.46 7.46 0 0 0 4.19 1.3c.27 0 .5-.13.6-.35a.63.63 0 0 0-.05-.65 8.08 8.08 0 0 1-1.29-2.58 5.42 5.42 0 0 1-.15-.75zm-3.85 1.32l-.08-.28-.4.12a9.72 9.72 0 0 1-2.84.43c-4.96 0-9-3.71-9-8.27 0-4.55 4.04-8.26 9-8.26 4.95 0 8.77 3.71 8.77 8.27 0 2.25-.75 4.35-2.5 5.92l-.24.21v.32a5.59 5.59 0 0 0 .21 1.29c.19.7.49 1.4.89 2.08a6.43 6.43 0 0 1-2.67-1.06c-.34-.22-.88-.48-1.16-.74z"})})})),y=Object(s.a)((function(){return Object(p.jsxs)("svg",{viewBox:"0 0 1143 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"16296",width:"29",height:"29",children:[Object(p.jsx)("defs",{children:Object(p.jsx)("style",{type:"text/css"})}),Object(p.jsx)("path",{d:"M560.35 796.723c-121.769 0-218.468-100.281-218.468-225.631s96.699-225.631 218.468-225.631c121.769 0 218.468 100.281 218.468 225.631s-96.699 225.631-218.468 225.631zM560.35 381.277c-100.281 0-182.652 85.954-182.652 189.815s82.373 189.815 182.652 189.815c100.281 0 182.652-85.954 182.652-189.815 0-103.861-82.373-189.815-182.652-189.815z","p-id":"16297"}),Object(p.jsx)("path",{d:"M560.35 674.955c-53.722 0-100.281-46.559-100.281-103.861s46.559-103.861 100.281-103.861 100.281 46.559 100.281 103.861-42.977 103.861-100.281 103.861zM560.35 503.045c-35.813 0-64.465 28.652-64.465 68.047 0 35.813 28.652 68.047 64.465 68.047s64.465-28.652 64.465-68.047c0-35.813-28.652-68.047-64.465-68.047z","p-id":"16298"}),Object(p.jsx)("path",{d:"M560.35 932.818c-214.886 0-411.865-136.094-519.307-354.562-3.582-3.582-3.582-10.745 0-14.325 107.442-218.468 308.003-354.562 519.307-354.562 214.886 0 411.865 136.094 519.307 354.562 3.582 3.582 3.582 10.745 0 14.325-103.861 218.468-304.421 354.562-519.307 354.562zM76.855 571.094c103.861 200.56 286.515 325.91 483.493 325.91s383.214-125.35 483.493-325.91c-103.861-200.56-286.515-325.91-483.493-325.91s-383.214 125.35-483.493 325.91z","p-id":"16299"})]})})),g=Object(s.a)((function(){return Object(p.jsx)("svg",{height:"16",viewBox:"0 0 16 16",version:"1.1",width:"16","data-view-component":"true",children:Object(p.jsx)("path",{d:"M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"})})})),w=c(120),I=c.n(w),N=c(8),k=c(21),E={"+1":x,"-1":x,commoent:_,view:y,laugh:x,confused:x,heart:x,hooray:x,rocket:x,eyes:x};var C=Object(s.a)((function(e){var t=e.children,c=Object(h.a)(e,["children"]);return Object(p.jsxs)("span",Object(n.a)(Object(n.a)({className:"".concat(I.a.reaction," ").concat(c.isActive?I.a.active:"")},c.onClick?{onClick:function(){return c.onClick()}}:{}),{},{children:[t({}),c.count]}))})),S=Object(s.a)((function(e){var t=Array.isArray(e.data)?function(e){var t=e.reactions,c=e.defaultEnableds,n=void 0===c?[]:c,a=e.userInfo,r={};n.forEach((function(e){r[e]={count:0}}));var i,s=Object(v.a)(t);try{for(s.s();!(i=s.n()).done;){var o=i.value;r[o.content]||(r[o.content]={count:0}),a&&o.user.id===a.id&&(r[o.content].owner={userId:a.id,id:o.id}),r[o.content].count++}}catch(l){s.e(l)}finally{s.f()}return r}({reactions:e.data,userInfo:e.userInfo,defaultEnableds:e.defaultEnableds}):Object.keys(e.data).reduce((function(t,c){return Object(n.a)(Object(n.a)({},t),{},Object(b.a)({},c,{count:e.data[c]}))}),{}),c=Object.keys(t).filter((function(c){var n;return E[c]&&(t[c].count>0||(null===(n=e.defaultEnableds)||void 0===n?void 0:n.includes(c)))})).map((function(c){return Object(p.jsx)(C,Object(n.a)(Object(n.a)({count:t[c].count,isActive:!!t[c].owner},e.onIncrement?{onClick:function(){return e.onIncrement(c,t[c].owner)}}:{}),{},{children:E[c]}),c)}));return Object(p.jsx)(i.Fragment,{children:c})})),A={};function z(e){var t=e.delApi,c=e.allApi,a=e.addApi,i=e.paths,s=e.user,o=e.namespace,l=void 0===o?c:o,d=Object(u.b)(l,(function(){return N.axios.get(c,{paths:i})}),[]),j=Object(r.a)(d,2),b=j[0],m=j[1];A[l]=!1;var f=s?function(e,c){var r;if(!A[l]){var o=null;if(A[l]=!0,c&&t)m(b.filter((function(e){return e.id!==c.id}))),o=N.axios.delete(t,{paths:Object(n.a)(Object(n.a)({},i),{},{reactionId:c.id})});else if(!c&&a){var u={content:e,created_at:(new Date).toISOString(),id:0,user:s};m(b.concat(u)),o=N.axios.request({url:a,method:"POST",paths:i,data:{content:e}}).then((function(e){m(b.filter((function(e){return e!==u})).concat(e))}))}null===(r=o)||void 0===r||r.catch((function(){return m(b)})).then((function(){return A[l]=!1}))}}:k.a;return[b,f]}var M,R,T=c(6),U=c(121),L=c.n(U),P=c(47),D=function(e){var t=e.children,c=e.parent,n=void 0===c?document.documentElement:c,a=e.target,r=Object(T.f)(a,n,!0),i=r.x,s=r.y;return Object(P.createPortal)(Object(p.jsx)("div",{className:L.a["tip-layer"],style:{width:"140px",left:i-140+"px",top:s+"px"},children:t}),n)},q=function(e){var t=e.options,c=e.onSelect;return Object(p.jsx)("div",{className:L.a["select-layer"],children:t.map((function(e){return Object(p.jsx)("div",{onClick:function(){return c&&c(e)},className:e.warn?L.a.warn:"",children:e.label},e.value)}))})},W=function(e){var t=e.children,c=e.options,n=e.onSelect,a=document.body,s=i.useState(null),o=Object(r.a)(s,2),l=o[0],u=o[1],d=i.useState(!1),j=Object(r.a)(d,2),b=j[0],m=j[1];return i.useEffect((function(){var e=!1,t=function(){setTimeout((function(){e||m(!1)}))};return a.addEventListener("click",t),function(){a.removeEventListener("click",t),e=!0}}),[a]),Object(p.jsxs)(i.Fragment,{children:[Object(p.jsx)("span",{className:L.a.place,onClick:function(e){m(!0),e.stopPropagation()},ref:function(e){return u(e)},children:t}),b&&l?Object(p.jsx)(D,{parent:a,target:l,children:Object(p.jsx)(q,{options:c,onSelect:n})}):null]})},B=Object(s.a)((function(e){return Object(p.jsxs)("div",{className:O.a.chat,children:[Object(p.jsxs)("div",{className:O.a.head,children:[Object(p.jsx)("div",{className:O.a.avatar,children:Object(p.jsx)("a",{href:e.userInfo.html_url,target:"_blank",rel:"noreferrer",children:Object(p.jsx)("img",{src:e.userInfo.avatar_url,alt:e.userInfo.login})})}),e.head]}),Object(p.jsx)("div",{className:O.a.body,children:e.children})]})}));!function(e){e[e.EDIT=0]="EDIT",e[e.VIEW=1]="VIEW"}(R||(R={}));var F=(M={},Object(b.a)(M,R.EDIT,"\u7f16\u5199"),Object(b.a)(M,R.VIEW,"\u9884\u89c8"),M),V=Object(s.a)((function(e){var t=e.userInfo,c=e.onChange,n=e.children,a=e.value,s=void 0===a?"":a,o=e.forwardRef,l=i.useRef(null),u=i.useState(R.EDIT),d=Object(r.a)(u,2),j=d[0],b=d[1],f=i.useState(null),h=Object(r.a)(f,2),v=h[0],x=h[1];i.useEffect((function(){var e=new m({element:l.current,spellChecker:!1,status:!1,initialValue:"",toolbar:["code","link","image","table","|","bold","italic","strikethrough","|","heading-1","heading-2","heading-3","|","quote","unordered-list","ordered-list","horizontal-rule","|","fullscreen","guide"],previewRender:function(e){return'<div class="marked-body input-marked">'.concat(Object(T.a)(e),"</div>")}});return x(e),function(){e.toTextArea()}}),[l]),i.useEffect((function(){v&&v.value()!==s&&(v.value(s),function(e){var t=e.value().split("\n");e.codemirror.focus(),e.codemirror.setCursor(t.length,t[t.length-1].length)}(v))}),[s,v]),i.useImperativeHandle(o,(function(){return{focus:function(){null===v||void 0===v||v.codemirror.focus()}}}));var _=Object(p.jsx)("div",{className:O.a["mode-tabs"],children:Object.keys(F).map((function(e){return Object(p.jsx)("span",{className:j===Number(e)?O.a.active:"",onClick:function(){return function(e){v&&((e===R.VIEW&&!v.isPreviewActive()||e===R.EDIT&&v.isPreviewActive())&&m.togglePreview(v),b(e))}(Number(e))},children:F[e]},e)}))});return c&&(null===v||void 0===v||v.codemirror.on("change",(function(){c(v.value(),s)}))),Object(p.jsxs)(B,{userInfo:t,head:_,className:O.a["md-edit"],children:[Object(p.jsx)("textarea",{ref:l,className:O.a.input}),Object(p.jsx)("div",{className:O.a.btns,children:n})]})})),H=Object(s.a)((function(e){var t,c=i.useState(e.body),s=Object(r.a)(c,2),o=s[0],l=s[1],u=e.currentUser?z({allApi:N.config.commentReactions,delApi:N.config.commentReaction,addApi:N.config.commentReactions,user:e.currentUser,namespace:"".concat(e.id,"/reactions"),paths:{id:e.id}}):function(e){var t=i.useState(e);return[Object(r.a)(t,1)[0],k.a]}(e.reactions),d=Object(r.a)(u,2),j=d[0],b=d[1],m=[{label:"\u5f15\u7528",value:"quote"},{label:"\u56de\u590d",value:"reply"}].concat(Object(a.a)((null===(t=e.currentUser)||void 0===t?void 0:t.id)===e.user.id?[{label:"\u4fee\u6539",value:"update"},{label:"\u5220\u9664",value:"delete",warn:!0}]:[]));return"ready"===e.mode?Object(p.jsxs)(B,{className:O.a["commit-item"],userInfo:e.user,head:Object(p.jsxs)(i.Fragment,{children:[Object(p.jsx)("strong",{children:e.user.login}),Object(p.jsxs)("div",{className:O.a.oper,children:[Object(p.jsxs)("span",{className:O.a.time,children:["\u8bc4\u8bba\u4e8e",Object(T.d)(new Date(e.created_at))]}),Object(p.jsx)(W,{options:m,onSelect:function(t){return e.onOper&&e.onOper(t.value)},children:Object(p.jsx)(g,{})})]})]}),children:[Object(p.jsx)("div",{className:"marked-body",dangerouslySetInnerHTML:{__html:Object(T.a)(e.body)}}),Object(p.jsx)("div",{className:O.a.reactions,children:Object(p.jsx)(S,{data:j,onIncrement:b,userInfo:e.currentUser,defaultEnableds:["+1","-1"]})})]}):Object(p.jsxs)(V,{value:o,userInfo:e.currentUser,onChange:function(e){return l(e)},children:[Object(p.jsx)("button",Object(n.a)(Object(n.a)({className:"primary"},o?{}:{disabled:!0}),{},{onClick:function(){return e.onOper&&e.onOper("enterUpdate",o)},children:"\u4fee\u6539"})),Object(p.jsx)("button",{className:"cancel",onClick:function(){return e.onOper&&e.onOper("cacelUpdate")},children:"\u53d6\u6d88"})]})})),J=Object(s.a)((function(e){var t=e.comments,c=e.user,a=e.onOper,r=e.edits;return t.length?Object(p.jsx)("div",{children:t.map((function(e){return Object(i.createElement)(H,Object(n.a)(Object(n.a)({},e),{},{mode:r.includes(e)?"write":"ready",currentUser:c,key:e.id,className:O.a["commit-item-layer"],onOper:function(t,c){return a(t,e,c)}}))}))}):Object(p.jsx)("div",{className:O.a["un-comments"],children:Object(p.jsx)("p",{children:"\u6682\u65e0\u8bc4\u8bba"})})})),K=c(36),Q=c(59),X={"+1":0,"-1":0,confused:0,eyes:0,heart:0,hooray:0,laugh:0,rocket:0},Y=Object(s.a)((function(e){return Object(p.jsx)("div",{className:l.a["article-reactions"],children:Object(p.jsxs)("div",{className:l.a.reactions,children:[e.reactions&&Object(p.jsx)(S,{data:e.reactions,onIncrement:e.onIncrement,userInfo:e.userInfo,defaultEnableds:e.defaultEnableds}),Object(p.jsx)(C,{count:e.comment,isActive:!1,onClick:e.gotoComment,children:E.commoent}),Object(p.jsx)(C,{count:e.view,isActive:!1,children:E.view})]})})})),G=Object(s.a)((function(e){return Object(p.jsxs)("div",{className:l.a["join-columns"],children:[Object(p.jsx)(d.b,{to:Object(j.b)("special"),children:e.title}),Object(p.jsx)(d.b,{to:Object(j.b)("special"),children:e.title})]})})),Z=Object(s.a)((function(e){var t={issuesId:e.issues.number},c=i.useState(void 0),s=Object(r.a)(c,2),o=s[0],d=s[1],j=i.useState(Object(k.f)()),b=Object(r.a)(j,1)[0],m=Object(u.b)("article/comments/".concat(e.issues.number),(function(){return N.axios.get(N.config.comments,{paths:t})}),null),f=Object(r.a)(m,2),O=f[0],h=f[1],v=i.useState([]),x=Object(r.a)(v,2),_=x[0],y=x[1],g=z({user:o,allApi:N.config.articleReactions,delApi:N.config.articleReaction,addApi:N.config.articleReactions,namespace:"".concat(e.issues.number,"/reactions"),paths:{id:e.issues.number}}),w=Object(r.a)(g,2),I=w[0],E=w[1],C=i.useState(""),S=Object(r.a)(C,2),A=S[0],M=S[1],R=i.createRef(),T=i.createRef();return i.useEffect((function(){b&&N.axios.get(N.config.userInfo).then(d)}),[b]),Object(p.jsxs)("div",{className:l.a["interact-layer"]+" "+l.a.variable,children:[Object(p.jsx)(G,Object(n.a)(Object(n.a)({},e.column),{},{className:l.a.section})),Object(p.jsx)(Y,{onIncrement:E,className:l.a.section,reactions:I,userInfo:o,comment:O?O.length:0,gotoComment:function(){var e;return o?null===(e=R.current)||void 0===e?void 0:e.focus():Object(k.a)()},defaultEnableds:["+1"],view:8}),Object(p.jsx)("div",{className:l.a.boundary,children:o?Object(p.jsxs)(i.Fragment,{children:[Object(p.jsx)(K.a,{ref:T}),Object(p.jsx)(V,{forwardRef:R,userInfo:o,onChange:M,value:A,children:Object(p.jsx)("button",Object(n.a)(Object(n.a)({},A?{}:{disabled:!0}),{},{onClick:function(){return function(e){var c;O&&(null===(c=T.current)||void 0===c||c.startLoading(),N.axios.post(N.config.comments,{body:e},{paths:t}).then((function(e){var t;null===(t=T.current)||void 0===t||t.stopLoading(),h([Object(n.a)(Object(n.a)({},e),{},{reactions:Object(n.a)(Object(n.a)({},X),{},{url:""})})].concat(Object(a.a)(O))),M("")})))}(A)},className:"primary",children:"\u53d1\u8868"}))})]}):Object(p.jsxs)("div",{className:l.a.unauth,children:["\u6682\u672a\u6388\u6743\u767b\u5f55\uff0c",Object(p.jsx)("a",{href:Object(k.d)(),children:"\u6388\u6743\u8ddf\u535a\u4e3b\u4e92\u52a8"})]})}),O?Object(p.jsx)(J,{edits:_,onOper:function e(t,c,r){if(!o)return Object(k.a)();switch(t){case"quote":M("> ".concat(c.body.split(/(?:\n)|(?:\r\n)/).join("\n> "),"\n\n"));break;case"reply":M("@".concat(c.user.login," "));break;case"update":y([].concat(Object(a.a)(_),[c]));break;case"cacelUpdate":y(_.filter((function(e){return e!==c})));break;case"enterUpdate":r&&O&&(N.axios.request({url:N.config.comment,method:"PATCH",paths:{commentId:c.id},data:{body:r}}),h(O.map((function(e){return e===c?Object(n.a)(Object(n.a)({},c),{},{body:r}):e}))),e("cacelUpdate",c));break;case"delete":if(!window.confirm("\u786e\u5b9a\u8981\u5220\u9664\u6b64\u8bc4\u8bba\u5417\uff1f"))return;h(O.filter((function(e){return e.id!==c.id}))),N.axios.delete(N.config.comment,{paths:{commentId:c.id}}).catch((function(){return h(O)}))}},className:l.a.boundary,comments:O,user:o}):Object(p.jsx)(Q.a,{})]})}));t.default=Z},117:function(e,t){},119:function(e,t,c){e.exports={chat:"style_chat__1gl94",head:"style_head__c1Be5",avatar:"style_avatar__2r7Ru",body:"style_body__3Jrjh","commit-item":"style_commit-item__9sWax",time:"style_time__24MXN",oper:"style_oper__oC-KU",reactions:"style_reactions__3rNWN","commit-item-layer":"style_commit-item-layer__2x_-t","md-edit":"style_md-edit__3PSy5","mode-tabs":"style_mode-tabs__3RY9T",active:"style_active__2s66l",input:"style_input__1mejh",btns:"style_btns__365tx","un-comments":"style_un-comments__3i_64"}},120:function(e,t,c){e.exports={reaction:"style_reaction__3y9af",active:"style_active__3T7g6"}},121:function(e,t,c){e.exports={place:"style_place__1NzD0","tip-layer":"style_tip-layer__fsQ3P","select-layer":"style_select-layer__3ISCg",warn:"style_warn__1F0qN"}}}]);
//# sourceMappingURL=4.fbd72a16.chunk.js.map