<!doctype html><html lang="en"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/><meta name="theme-color" content="#000000"/><link rel="icon" href="/static/images/favicon.ico"/><link rel="apple-touch-icon" href="/static/images/logo192.png"/><link rel="stylesheet" href="/static/lib/simplemde.min.css"><script async src="https://www.googletagmanager.com/gtag/js?id=G-0L4WRG1D3N"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-0L4WRG1D3N")</script><title>webpack5基础知识 | bill-lai 的博客</title><link href="/static/css/main.b7f30772.chunk.css" rel="stylesheet"></head><body><noscript>You need to enable JavaScript to run this app.</noscript><div id="root"><div class="style_app__1yczT"><header class="style_slide__z5PNT style_slide__3Yi3e"><a href="/"><img src="/static/media/portrait.df7a5375.jpg" class="style_portrait__2GrBh" alt="portrait"/></a><div class="style_content__3GlZB"><div class="style_introduce__2UxnL"><h1><a href="/">bill-lai</a></h1><p>专注 WEB 端开发</p></div><ul class="style_navs__2yN9I"><li><a href="/">首页</a></li><li><a href="/archive">专题</a></li><li><a href="/special">归档</a></li></ul></div></header><div class="style_body__3Yz5T"><div class="style_layer__1ZQZt"><div class="style_main__XnHDF"><div> <h1 class="main-title">webpack5基础知识<span class="marker">2022-03-28 22:03</span></h1><div class="marked-body"><div><blockquote>
<p>注意，本文使用 webpack5.68.0，不同版本可能会有细微区别。</p>
</blockquote>
<p><a href="https://www.webpackjs.com/">webpack</a>是一个模块化打包 JavaScript 的工具，在 Wepack 里一切文件皆模块，通过<code>Loader</code>翻译转化文件，通过<code>Plugin</code>注入钩子，最后输出多个模块组合的文件，而<code>Webpack</code>专注于构建模块化项目。官网的首页图说明了<code>Webpack</code>是什么：</p>
<p><img src="/article/46492e8d9418d7f0ad08/./image/1-2webpack.png" alt="webpack"></p>
<p>对于<code>webpack</code>的基础配置及概念可以从<a href="https://www.webpackjs.com/">官网文档</a>中学习，本文列举<code>webpack</code>的在生产环境和开发环境中通用的<code>Plugin</code>和<code>Loader</code>及配置。</p>
<p>本文后续会出现经常提及<code>chunk</code>和<code>bundle</code>在这里我们先解析一下这个概念</p>
<h2 id="chunk">chunk</h2>
<p><code>chunk</code>从字面意思是代码块，在<code>Webpack</code>中<code>chunk</code>代表许多关联<code>module</code>的集合。比如在<code>webpack.config.js</code>声明了入口模块<code>entry</code>，入口模块又关联了其他模块，这一系列关联的模块就是一个<code>chunk</code>。</p>
<p>在<code>webpack</code>中产生<code>chunk</code>有三种途径。</p>
<h3 id="entry-产生的-chunk">entry 产生的 chunk</h3>
<p>在<code>webpack.config.js</code>中可以声明<code>entry</code>来指代入口模块，<code>entry</code>合法类型有<code>string | Array | object</code></p>
<p><code>entry</code>字段值如果是<code>string | Array</code>会产生一个名为<code>main</code>的<code>chunk</code>；如果是<code>Array</code>则将数组里的源代码都打包到一个<code>chunk</code>中。如下：</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">"./src/main.js"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src/main.js"</span><span class="token punctuation">,</span> <span class="token string">"./src/other.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>如果是一个对象，则会声明与<code>key</code>数量相同<code>chunk</code>，并且会使用<code>key</code>来作为<code>chunk</code>的名称。这就是为什么<code>entry</code>是对象，<code>output.filename</code>如果写死名称会直接报错的原因，因为一个名称不够让多个<code>chunk</code>输出。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token keyword module">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">main</span><span class="token operator">:</span> <span class="token string">"./src/main.js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token string">"./src/other.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"./dist"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 会产生 main.js  other.js两个文件</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[name].js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="按需加载（异步）产生的-chunk">按需加载（异步）产生的 chunk</h3>
<p>按需加载（异步）加载的模块也会产生<code>chunk</code>，这个<code>chunk</code>名称可以在代码中使用<code>webpackChunkName</code>自行定义。如果需要打包的时候使用<code>chunk</code>名称，则需要在<code>output.chunkFilename</code>中引用。</p>
<pre><code class="language-js"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span><span class="token keyword module">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">"[name].js"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// module</span>
<span class="token keyword module">import</span><span class="token punctuation">(</span><span class="token comment">/* webpackChunkName: "async-model" */</span> <span class="token string">"./async-model"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="代码分隔产生的-chunk">代码分隔产生的 chunk</h3>
<p>在<code>webpack5</code>中代码分割使用<code>SplitChunksPlugin</code>插件实现，这个插件内置在<code>webpack</code>中，在使用时直接用配置的方式即可。代码分隔时也会产生<code>chunk</code>，我们用代码来说明一下：</p>
<pre><code class="language-js"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span><span class="token keyword module">export</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"./src/a.js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">"./src/b.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">optimization</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 分隔webpack运行时代码</span>
    <span class="token literal-property property">runtimeChunk</span><span class="token operator">:</span> <span class="token string">"single"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">splitChunks</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">"all"</span><span class="token punctuation">,</span>
      <span class="token comment">// 分隔组</span>
      <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// 抽取第三方模块</span>
        <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
          <span class="token literal-property property">prioity</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token comment">// 抽取</span>
        <span class="token literal-property property">commons</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token comment">// 抽取的chunk最小大小</span>
          <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token comment">// 最小引用数</span>
          <span class="token literal-property property">prioity</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
          <span class="token literal-property property">reuseExistingChunk</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// a.js</span>
<span class="token keyword module">import</span> <span class="token string">"c.js"</span><span class="token punctuation">;</span>
<span class="token keyword module">import</span> <span class="token imports">$</span> <span class="token keyword module">from</span> <span class="token string">"jquery"</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span>$<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// b.js</span>
<span class="token keyword module">import</span> <span class="token string">"c.js"</span><span class="token punctuation">;</span>

<span class="token comment">// commons.js</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>上方代码使用了代码分隔，总共会产生 6 个<code>chunk</code></p>
<ul>
<li>两个入口分别分配到名为<code>a</code>和<code>b</code>的<code>chunk</code></li>
<li><code>runtimeChunk</code>声明抽离<code>webpack</code>运行时代码抽离到一个唯一的名称的<code>chunk</code>，我们有两个入口，有两份运行时<code>chunk</code></li>
<li><code>jquery</code>符合<code>cacheGroups.vendors</code>规则，抽离到名为<code>vendors</code>的<code>chunk</code></li>
<li><code>commons.js</code>符合<code>cacheGroups.commons</code>规则，抽离到名为<code>commons</code>的<code>chunk</code></li>
</ul>
<p>如下图所示</p>
<p><img src="/article/46492e8d9418d7f0ad08/./image/build.png" alt="build"></p>
<h2 id="bundle">bundle</h2>
<p><code>bundle</code>就是我们最终输出的一个或多个文件，大多数情况下一个<code>chunk</code>至少会产生一个<code>bundle</code>，但是不完全是一对一的关系。比如我们在模块中引用图片又经过<code>url-loader</code>打包到外部；或者是引用了样式，通过<code>extract-text-webpack-plugin</code>抽离出来，这样一个<code>chunk</code>就会出现产生多个<code>bundle</code>的情况。</p>
<p>简单来说<code>bundle</code>就是<code>chunk</code>在构建完成的呈现。</p>
<h2 id="entry-和-context">entry 和 context</h2>
<p><code>entry</code>是<code>webpack</code>的启动模块入口，<code>webpack</code>将根据指定的这个起点来查找模块，生成<code>chunk</code>，<code>entry</code>的合法值有：</p>
<ol>
<li><code>string</code>，入口起点的模块路径，<code>webapck</code>将生成名为<code>main</code>的<code>chunk</code></li>
<li><code>Array</code>，入口起点的一组模块的路径，<code>webpack</code>将组的中每个模块拼合在一起，并生成名为<code>main</code>的<code>chunk</code></li>
<li><code>{ [key in string]: string | Array }</code>，多个入口起点，<code>webpack</code>根据<code>value</code> <em>（跟 1,2 合法值一致）</em>为入口起点，<code>key</code>为名称的<code>chunk</code>。</li>
<li><code>function</code>，获取入口起点的方法，返回值为 1,2,3 或<code>Promise&lt;1,2,3&gt;</code>，我们可以指定动态入口。</li>
</ol>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./app/entry1"</span><span class="token punctuation">,</span> <span class="token string">"./app/entry2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"./app/entry-a"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./app/entry-b1"</span><span class="token punctuation">,</span> <span class="token string">"./app/entry-b2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">entry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">"./app/entry-a"</span><span class="token punctuation">,</span>
  <span class="token function-variable function">entry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./app/entry-a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>我们看到上方代码的入口模块值都是相对路径，默认情况下<code>webpack</code>想以当前目录为基础路径来查找。我们可以通过<code>context</code>来更改基础路径。</p>
<p><strong><code>webapck</code>查找<code>loader</code>和启动入口模块时，会以配置中的<code>context</code>为基础目录</strong>。下面我们来改上方代码</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">context</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"./app"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./entry1"</span><span class="token punctuation">,</span> <span class="token string">"./entry2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">"./entry-a"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./entry-b1"</span><span class="token punctuation">,</span> <span class="token string">"./entry-b2"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">entry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token string">"./entry-a"</span><span class="token punctuation">,</span>
  <span class="token function-variable function">entry</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">"./entry-a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="output">output</h2>
<p>默认情况下<code>webpack</code>会在<code>dist</code>输出<code>chunk</code>生成的<code>bundle</code>，文件名就是<code>chunk</code>名称。</p>
<h3 id="filename-和-chunkfilename">filename 和 chunkFilename</h3>
<p>我们可以通过<code>output.filename</code>来修改非按需加载<code>chunk</code>生产<code>bundle</code>的名称。<code>output.filename</code>的合法值有<code>string | (pathData: PathData) =&gt; string</code>，默认值为<code>[name].js</code>。</p>
<p>如果我们的项目中只有一个非按需加载的<code>chunk</code>（几乎不存在），可以使用静态名称来定义生产的<code>bundle</code>名称，如果有多个<code>chunk</code>就不行了，因为多个<code>chunk</code>无法放到一个<code>bundle</code>中</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"bundle.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>我们可以使用<code>webpack</code>内提供的模板字符串来定义<code>bundle</code>文件名，下表列举了常用的模板字符串：</p>
<table>
<thead>
<tr>
<th>模板</th>
<th>描述</th>
<th>稳定性</th>
</tr>
</thead>
<tbody><tr>
<td>[name]</td>
<td><code>chunk</code>的名称</td>
<td>只要<code>chunk</code>名称不修改就不会变化</td>
</tr>
<tr>
<td>[hash]</td>
<td>根据所有<code>chunk</code>生成的<code>hash</code></td>
<td>工程中某个<code>chunk</code>被修改就会引起变化</td>
</tr>
<tr>
<td>[chunkhash]</td>
<td>根据<code>chunk</code>生成的<code>hash</code>值</td>
<td>某个<code>chunk</code>被修改，只会引起被修改<code>chunk</code>的<code>hash</code></td>
</tr>
<tr>
<td>[contenthash]</td>
<td>根据<code>bundle</code>内容内容产生的<code>hash</code></td>
<td><code>chunk</code>中某个<code>bundle</code>被修改，只会引起被修改<code>bundle</code>的<code>hash</code></td>
</tr>
</tbody></table>
<p>下面代码例举了如何使用模板。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">outpit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 直接使用</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[name].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[hash].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[chunkhash].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[contenthash].js"</span><span class="token punctuation">,</span>
    <span class="token comment">// 组合使用</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[name]-[contenthash].js"</span><span class="token punctuation">,</span>
    <span class="token comment">// 限定hash位数</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[hash:5].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"[contenthash:5].bundle.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>在使用<code>[hash]</code>时需要注意，因为它是所有<code>chunk</code>都共享的，所以直接用<code>[hash]</code>可能会引起错误，跟上方使用静态变量一样，多个<code>chunk</code>无法放置到一个<code>bundle</code>。</p>
<p>前面我们讲解了<code>filename</code>的配置方式，它们对非按需加载（异步）的<code>chunk</code>生效，如果需要对按需加载的<code>chunk</code>配置，那就需要用到<code>outpit.chunkFilename</code>了，它和<code>filename</code>的使用方式是一样的，这里不在赘述。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">outpit</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">"[name].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">"[hash].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">"[chunkhash].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">"[hash:5].js"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">"[contenthash:5].bundle.js"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="path">path</h3>
<p>默认情况下<code>webpack</code>会将打包的文件输出到<code>dist</code>文件夹中，我们可以通过配置<code>output.path</code>来更改输出目录。</p>
<p>在<code>path</code>可以使用<code>[hash]</code>的模板字符串，因为每次文件修改后<code>hash</code>都不一样，很容易就能生成所有版本构建后代码文件。</p>
<pre><code class="language-js"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">path</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"./dist-[hash]"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="html-自动引入-bundle-文件">html 自动引入 bundle 文件</h2>
<p>如果要实现缓存目的，可以使<code>hash</code>来输出<code>bundle</code>。由于每次打包后的<code>hash</code>都可能会更改，在<code>html</code>手动引入<code>bundle</code>很麻烦，我们可以借助<a href="https://github.com/jantimon/html-webpack-plugin">html-webpack-plugin</a>插件来实现自动引入<code>bundle</code>。</p>
<p><code>html-webpack-plugin</code>的使用方式非常简单，只需创建一个实例，放置到<code>plugins</code>中就会自动生成在<code>output.path</code>中生成一个默认的<code>html</code>，这个<code>html</code>将会自动引入所有<code>chunk</code>生成的<code>bundle</code>。接下来我们创建最一个简单的使用。</p>
<pre><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">HtmlWebpackPlugin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"html-webpack-plugin"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>在创建<code>html-webpack-plugin</code>实例时可以传入许多参数，可以通过<a href="https://github.com/jantimon/html-webpack-plugin">官方文档</a>了解，接下来我们看看最常用的几种定制。</p>
<h3 id="定制-html">定制 html</h3>
<p><code>template</code>参数可以指定生成<code>html</code>的模板，我们可以在这个<code>html</code>中编写自己需要的东西。<br><code>filename</code>参数可以指定<code>html-webpack-plugin</code>将<code>html</code>输出到哪里，这个参数的配置方式跟<code>outpit.filename</code>一样。<br><code>minify</code>参数可以决定是否压缩<code>html</code>，在<code>production</code>模式下会自动为<code>true</code>。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"assets/template.html"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"index.html"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">minify</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="多页面">多页面</h3>
<p>上面我们说的<code>html-webpack-plugin</code>会自动产生一个<code>html</code>并引入所有<code>chunk</code>，这很适合<code>SPA</code> <em>（单页面）</em> 开发。而<code>MPA</code>需要多个<code>html</code>，而且每个<code>html</code>需要的<code>chunk</code>也不一样，接下来我们看看这个插件是如何适配<code>MPA</code>开发的。</p>
<p>一个<code>html-webpack-plugin</code>实例会生产输出一个<code>html</code>，多个实例就会生产输出多个<code>html</code>，只需要在<code>plugins</code>中添加多个实例即可。<code>html-webpack-plugin</code>中有个<code>chunks</code>参数来指定<code>html</code>要关联的所有<code>chunk</code>。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">content</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">login</span><span class="token operator">:</span> <span class="token string">'./login.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">home</span><span class="token operator">:</span> <span class="token string">'./home.js'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">base</span><span class="token operator">:</span> <span class="token string">'./base.js'</span>
  <span class="token punctuation">}</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'assets/template.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'login.html'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">,</span> <span class="token string">'base'</span><span class="token punctuation">]</span>  <span class="token comment">//需要关联的所有chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'assets/template.html'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'home.html'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'home'</span><span class="token punctuation">,</span> <span class="token string">'base'</span><span class="token punctuation">]</span>  <span class="token comment">//需要关联的所有chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="cdn-加速和缓存处理">cdn 加速和缓存处理</h3>
<p>如果我们把<code>bundle</code>都上传到了<code>cdn</code>上，就需要对打包后的资源引入路径进行修改，我们可以通过<code>publicPath</code>参数给我们指定资源的前缀路径。<br>使用<code>cdn</code>一般会产生缓存问题，如果你的<code>output.filename</code>没有使用<code>hash</code>那更新后的文件不会立即生效。我们可以使用<code>hash</code>参数给引入路径加上此次构建缓存。 <em>（更好的方式是使用 output.filename），因为如果使用构建缓存意味着每次更新所有缓存都会被刷新。</em></p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"assets/template.html"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">publicPath</span><span class="token operator">:</span> <span class="token string">"//www.cdn.com"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">hash</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"login.html"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"login"</span><span class="token punctuation">,</span> <span class="token string">"base"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//需要关联的所有chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<h3 id="扩展">扩展</h3>
<p><code>html-webpack-plugin</code>的<code>template</code>是使用<a href="https://ejs.bootcss.com/">ejs 模板语言</a>。<code>html-webpack-plugin</code>注入了许多变量给模板使用，我们可以直接在模板内使用这些变量来自定义扩展我们的<code>html</code>。</p>
<table>
<thead>
<tr>
<th>变量</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td><code>htmlWebpackPlugin.options</code></td>
<td>创建<code>HtmlWebpackPlugin</code>实例的参数</td>
</tr>
<tr>
<td><code>htmlWebpackPlugin.files</code></td>
<td><code>htmlWebpackPlugin</code>准备注入的<code>bundle</code>，如果<code>inject</code>为<code>true</code>则自动注入</td>
</tr>
<tr>
<td><code>webpackConfig</code></td>
<td><code>webpack</code>的配置</td>
</tr>
<tr>
<td><code>compilation</code></td>
<td><code>webpack</code>的<a href="https://webpack.docschina.org/api/compilation-object/#compilation-object-methods">编译对象</a></td>
</tr>
</tbody></table>
<p><code>htmlWebpackPlugin.files</code>的类型为</p>
<pre><code class="language-js"><span class="token keyword">type</span> <span class="token class-name">File</span> <span class="token punctuation">{</span>
  publicPath<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  js<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  css<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  manifest<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  favicon<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>接下来我们做个 demo，关闭<code>inject</code>,手动将<code>webpack</code>打包后的<code>css</code>和<code>js</code>都内联到<code>html</code>中：</p>
<pre><code class="language-js"><span class="token comment">// webpack.config.js</span>
module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"assets/template.ejs"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token literal-property property">inject</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      <span class="token literal-property property">title</span><span class="token operator">:</span> <span class="token string">'login'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">"login.html"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"login"</span><span class="token punctuation">,</span> <span class="token string">"base"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//需要关联的所有chunk</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<pre><code class="language-ejs"><span class="token comment">&lt;!-- template.ejs --></span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span> <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> htmlWebpackPlugin<span class="token punctuation">.</span><span class="token property-access">options</span><span class="token punctuation">.</span><span class="token property-access">titlea</span> </span><span class="token delimiter punctuation">%></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
  <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>cssFile <span class="token keyword">of</span> htmlWebpackPlugin<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">css</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> </span><span class="token delimiter punctuation">%></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
      <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> compilation<span class="token punctuation">.</span><span class="token property-access">assets</span><span class="token punctuation">[</span>cssFile<span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span>htmlWebpackPlugin<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">publicPath</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span>    
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>
  <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">}</span> </span><span class="token delimiter punctuation">%></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

  <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token keyword control-flow">for</span> <span class="token punctuation">(</span>jsFile <span class="token keyword">of</span> htmlWebpackPlugin<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">js</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span> </span><span class="token delimiter punctuation">%></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">
      <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%=</span><span class="token language-javascript"> compilation<span class="token punctuation">.</span><span class="token property-access">assets</span><span class="token punctuation">[</span>jsFile<span class="token punctuation">.</span><span class="token method function property-access">substr</span><span class="token punctuation">(</span>htmlWebpackPlugin<span class="token punctuation">.</span><span class="token property-access">files</span><span class="token punctuation">.</span><span class="token property-access">publicPath</span><span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </span><span class="token delimiter punctuation">%></span></span>    
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span>
  <span class="token ejs language-ejs"><span class="token delimiter punctuation">&lt;%</span><span class="token language-javascript"> <span class="token punctuation">}</span> </span><span class="token delimiter punctuation">%></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span>
</code></pre>
<h2 id="抽取公用代码">抽取公用代码</h2>
<p><code>SplitChunksPlugin</code>是改进<code>CommonsChunkPlugin</code>而重新设计和实现的代码分片插件。<code>SplitChunksPlugin</code>可以配置式的定义如何抽取<code>chunk</code>，这是个十分有用的功能。</p>
<ul>
<li>例如有一个模块被两个入口模块引用，默认情况下这个公用模块在两个<code>chunk</code>都会有，默认情况下生成的两个<code>bundle</code>都会包含这个公用模块的内容，我们可以通过<code>SplitChunksPlugin</code>将公用模块单独抽成一个<code>chunk</code>，生成三个<code>bundle</code>，两个入口<code>bundle</code>引用这个公用的<code>bundle</code>。</li>
<li>第三方库 <em>(通常在<code>node_modules</code>)</em> 通常情况下是不怎么会有大的变动的，为了充分利用缓存，我们可以把项目业务的代码和第三方库代码分成两个<code>chunk</code>，生成两份<code>bundle</code>，这样我们修改业务代码，第三方库的代码并不会变动，也就能利用上缓存了。 <em>(需要将output.filename修改成[chunkhash|contenthash].js)</em></li>
</ul>
<p>在默认情况下，<code>webpack</code>只会分片按需加载 <em>（只针对import(...)异步加载）</em> 的<code>chunks</code>。影响范围是在<code>optimization.splitChunks.chunks</code>中声明的，他们分别表示：</p>
<ul>
<li><code>initial</code>只影响入口<code>chunk</code>关联</li>
<li><code>async</code> <em>（默认）</em> 只影响按需加载的<code>chunk</code></li>
<li><code>all</code> 入口和按需加载都影响</li>
</ul>
<p>默认情况下的提取规则及主要配置代码：</p>
<ul>
<li><code>chunk</code>被多次引用或是来自<code>node_modules</code></li>
<li><code>js chunk</code>体积大于30K</li>
<li><code>css chunk</code>体积大于50K</li>
<li>按需加载并行数小于等于5 （同时间import(...)的数量）</li>
<li>首次加载并行数小于等于3（在html初次加载的 script引用数量）</li>
</ul>
<pre><code class="language-js"><span class="token comment">// splitChunks 默认配置</span>
<span class="token keyword">const</span> options <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 工作于哪里 async initial（只对入口的chunk生效） all： async + all</span>
  <span class="token literal-property property">chunks</span><span class="token operator">:</span> <span class="token string">'async'</span><span class="token punctuation">,</span>
  <span class="token comment">// 体积小于多少提取</span>
  <span class="token literal-property property">minSize</span><span class="token operator">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>

  <span class="token comment">// 另一种方式，指定模块类型</span>
  <span class="token comment">// minSize: {</span>
  <span class="token comment">//   javascript: 300000,</span>
  <span class="token comment">//   style: 500000</span>
  <span class="token comment">// },</span>

  <span class="token comment">// 最少被多少个chunk使用</span>
  <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
  <span class="token comment">// 按需加载并行数最小值</span>
  <span class="token literal-property property">maxAsyncRequests</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
  <span class="token comment">// 首次加载最大并行数</span>
  <span class="token literal-property property">maxInitialRequests</span><span class="token operator">:</span> <span class="token number">3</span>

  <span class="token comment">// 名称分隔符如模块A被chunk B和chunk C同时引用名称可能是default~B~C</span>
  <span class="token literal-property property">automaticNameDelimiter</span><span class="token operator">:</span> <span class="token string">'~'</span><span class="token punctuation">,</span>
  <span class="token comment">// 根据影响范围返回自动生成名称，比如 vendors~app1~app2.js</span>
  <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

  <span class="token comment">// 上方是公用配置，可以自定义组配置，如果没有覆盖则会集成上方配置</span>
  <span class="token comment">// key 为抽取后的chunk name</span>
  <span class="token literal-property property">cacheGroups</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 没覆盖的会继承上方配置，比如minChunks: 1,</span>
    <span class="token literal-property property">vendors</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">//  group 特有属性 提取第三方模块</span>
      <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\\/]node_modules[\\/]</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token comment">// 优先级，优先级会影响webpack选中哪个group</span>
      <span class="token comment">// 比如一个chunk即符合default规则也符合vendors规则，则查看优先级，哪个高用哪个</span>
      <span class="token literal-property property">priority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">10</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 多次引用提取</span>
    <span class="token keyword module">default</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 最小被两个chunk引用</span>
      <span class="token literal-property property">minChunks</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token comment">// 优先级</span>
      <span class="token literal-property property">prority</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">20</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>更多相关配置查看<a href="https://webpack.docschina.org/plugins/split-chunks-plugin/">官网</a></p>
<h2 id="使用非模块化库">使用非模块化库</h2>
<p>一些历史项目上有些第三方库不支持模块化，或者因为其他局限性不能模块化，只能全局导入。比如<code>jquery</code>如果使用模块化方式导入，有第三方的插件将找不到它，因为它们是直接用全局版本的。如果直接在全局上引用<code>jquery</code>是可以解决问题，但我们项目上良好的<code>ts</code>提示也没有了。我们可以使用<code>webpack</code>的<code>externals</code>属性来解决这类问题。</p>
<p><code>externals</code>能放置将<code>import</code>的包打包到<code>bundle</code>中，而是在运行时根据配置找到我们声明的扩展依赖并使用它。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">externals</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// key 为我们import的包名， value 为全局中变量名</span>
    <span class="token literal-property property">jquery</span><span class="token operator">:</span> <span class="token string">'jQuery'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 使用</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> ajax <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'jquery'</span>
<span class="token keyword module">import</span> <span class="token imports">$</span> <span class="token keyword module">from</span> <span class="token string">'jquery'</span>

<span class="token comment">// 将会转化为 jQuery.ajax({ ... })</span>
<span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token spread operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 将会转化为 jQuery('#app')</span>
<span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre>
<p>更多相关内容参考<a href="https://www.webpackjs.com/configuration/externals/">官网</a></p>
<h2 id="快捷路径访问模块">快捷路径访问模块</h2>
<p>如果我们的项目非常复杂而且项目路径比较深就可以考虑建立访问快捷路径，比如我们项目结构如下</p>
<pre><code class="language-text">project
|---packages
|-----components
|-------assets
|         1.png
|-----sdk
|-------config
|         default.json
|-----pro1
|       main.js
|-----pro2
|   scripts
|   webpack.config.js
</code></pre>
<p>在<code>main.js</code>中要访问<code>components</code>中的<code>1.png</code>就需要<code>import img from &#39;/packages/components/assets/1.png&#39;</code>，路径非常的长。为了解决这个问题我们可以使用<code>webpack</code>的<code>resplve.alias</code>。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'@ui'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./packages/components'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string-property property">'@sdk'</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./packages/sdk'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token comment">// 末尾用$标识精准匹配  只匹配 import '~sdkConfig'</span>
      <span class="token comment">// import '~sdkConfig/xxx'不会流向这里</span>
      <span class="token string-property property">'~sdkConfig<script>!function(e){function t(t){for(var n,o,i=t[0],c=t[1],l=t[2],s=0,p=[];s<i.length;s++)o=i[s],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(f&&f(t);p.length;)p.shift()();return u.push.apply(u,l||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(u.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={1:0},a={1:0},u=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[];o[e]?t.push(o[e]):0!==o[e]&&{4:1}[e]&&t.push(o[e]=new Promise((function(t,r){for(var n="static/css/"+({}[e]||e)+"."+{3:"31d6cfe0",4:"4422e775"}[e]+".chunk.css",a=i.p+n,u=document.getElementsByTagName("link"),c=0;c<u.length;c++){var l=(f=u[c]).getAttribute("data-href")||f.getAttribute("href");if("stylesheet"===f.rel&&(l===n||l===a))return t()}var s=document.getElementsByTagName("style");for(c=0;c<s.length;c++){var f;if((l=(f=s[c]).getAttribute("data-href"))===n||l===a)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||a,u=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");u.code="CSS_CHUNK_LOAD_FAILED",u.request=n,delete o[e],p.parentNode.removeChild(p),r(u)},p.href=a,document.getElementsByTagName("head")[0].appendChild(p)})).then((function(){o[e]=0})));var r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=a[e]=[t,n]}));t.push(r[2]=n);var u,c=document.createElement("script");c.charset="utf-8",c.timeout=120,i.nc&&c.setAttribute("nonce",i.nc),c.src=function(e){return i.p+"static/js/"+({}[e]||e)+"."+{3:"c6f781a0",4:"199baeb9"}[e]+".chunk.js"}(e);var l=new Error;u=function(t){c.onerror=c.onload=null,clearTimeout(s);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,r[1](l)}a[e]=void 0}};var s=setTimeout((function(){u({type:"timeout",target:c})}),12e4);c.onerror=c.onload=u,document.head.appendChild(c)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var c=this.webpackJsonpsource=this.webpackJsonpsource||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var f=l;r()}([])</script><script src="/static/js/2.b25e0f2c.chunk.js"></script><script src="/static/js/main.18e76180.chunk.js"></script></body></html></span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'./packages/sdk/config/default.json'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>然后我们就可以直接使用<code>import img from &#39;@ui/assets/1.png&#39;</code>了。</p>
<h2 id="使用es语法新特性">使用ES语法新特性</h2>
<p>在<code>ES6</code>发布以后，<code>TC39</code>规定每年都会发布新的版本。通常把<code>ES5</code>及其之前的版本统称做<code>ES5</code>。为了明确区分各个版本的内容，可以按照版本发布的时间进行描述，比如<code>ES2015</code>,<code>ES2016</code>。虽然目前部分浏览器都开始支持了，但由于各个浏览器标准支持不全，以及新特性支持没那么快，这导致在开发中不敢全面地使用新特性。</p>
<p>通常我们需要给新的<code>API</code>注入<code>polyfill</code>或者把新的<code>ES6</code>语法用<code>ES5</code>来使用新特性，<code>babel</code>就可以方便的完成。</p>
<p><code>Babel</code>是一个<code>JavaScript</code>编译器，能将新特性语法代码转为<code>ES5</code>代码，让你使用最新的语言特性而不用担心兼容性问题，并且可以通过插件机制根据需求灵活的扩展。在于<code>webpack</code>结合时需要使用<code>babel-loader</code>作为桥梁。</p>
<p>在编写配置之前我们需要安装<code>babel</code>核心库<code>@babel/core</code>，<code>babel</code>各个新特性转换的库<code>@babel/preset-env</code>以及<code>babel-loader</code></p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span>  --save-dev @babel/core @babel/preset-env babel-loader
</code></pre>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="目标环境">目标环境</h3>
<p><code>preset-env</code>会根据你编写代码按需加载支持代码，在没有配置的情况下会转换<code>ES2015</code>及以上的所有特性。我们可以通过<code>targets</code>参数来传递需要打包的目标环境，<code>babel</code>会根据<a href="https://caniuse.com/">caniuse</a>的数据来决定是否需要转换。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token comment">// 指定目标环境</span>
            <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token punctuation">{</span>
                  <span class="token comment">// chrome: '90',</span>
                  <span class="token comment">// ie: 11</span>
                  <span class="token comment">// node: 'current',</span>
                  <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">,</span> <span class="token string">'ie > 10'</span><span class="token punctuation">]</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="抽离转换代码">抽离转换代码</h3>
<p>默认情况下<code>babel</code>的所有转换代码都会直接内联到<code>js bundle</code>中，假如我们有多个<code>chunk</code>那每个<code>chunk</code>生成的<code>js bundle</code>都有转换代码，我们需要将他们统一抽离，减少<code>js bundle</code>的大小。我们可以使用<code>babel</code>提供的<code>@babel/plugin-transform-runtime</code>插件解决这一需求</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span>  --save-dev @babel/plugin-transform-runtime
</code></pre>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token punctuation">{</span> <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">,</span> <span class="token string">'ie > 10'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/plugin-transform-runtime'</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="开启编译缓存">开启编译缓存</h3>
<p><code>babel</code>转换是件耗时的事，我们可以通过<code>babel-loader</code>的<code>cacheDirectory</code>来开启缓存，不变动的文件没必要再次编译，加快编译。默认情况下缓存文件会存放在<code>node_modules/.cache</code>中。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">model</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token punctuation">{</span> <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'last 2 versions'</span><span class="token punctuation">,</span> <span class="token string">'ie > 10'</span><span class="token punctuation">]</span> <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'@babel/plugin-transform-runtime'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token literal-property property">cacheDirectory</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="资源模块管理">资源模块管理</h2>
<p>资源模块是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外。在<code>webpack5</code>中使用资源模块来代替<code>raw-loader</code>、<code>url-loader</code>、<code>file-loader</code>管理资源模块。</p>
<p>资源模块类型总共有4中类型来替换这些<code>loader</code></p>
<ul>
<li><code>asset/resource</code> 发送一个单独的文件并导出<code>URL</code>。之前通过使用<code>file-loader</code>实现。</li>
<li><code>asset/inline</code> 导出一个资源的<code>data URI</code>。之前通过使用<code>url-loader</code>实现。</li>
<li><code>asset/source</code> 导出资源的源代码。之前通过使用<code>raw-loader</code>实现。</li>
<li><code>asset</code> 在导出一个<code>data URI</code>和发送一个单独的文件之间自动选择，默认下小于<code>8k</code>的将视为<code>inline</code>。之前通过使用<code>url-loader</code>，并且配置资源体积限制实现。</li>
</ul>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 模型文件，统一导出为 URL</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.(obj|mtl)</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset/resource'</span><span class="token punctuation">,</span>
        <span class="token comment">// 覆盖outpit.assetModuleFilename 自定义导出bundle路径</span>
        <span class="token literal-property property">generator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'static/model/[hash][ext]'</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// 图片文件，如果大于 10KB将导出为URL否则内联源代码</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.(png|jpg|gif)$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">dataUrlCondition</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">maxSize</span><span class="token operator">:</span> <span class="token number">10</span> <span class="token operator">*</span> <span class="token number">1024</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// svg比较特殊，没有指定要raw时用URL，指定时用源码，所以需要二选一rules</span>
        <span class="token literal-property property">oneOf</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.svg$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            <span class="token comment">// 匹配模块引用路径query是否有raw，如果有则返回源码 </span>
            <span class="token comment">// 如 import svg from 'a.svg?raw'</span>
            <span class="token literal-property property">resourceQuery</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">raw</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset/source'</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.svg$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'asset/resource'</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// 输出asset资源</span>
      <span class="token literal-property property">assetModuleFilename</span><span class="token operator">:</span> <span class="token string">'images/[hash][ext]'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>outpit.assetModuleFilename</code>和<code>generator.filename</code>与<code>output.filename</code>相同不过适用于<code>Asset Modules</code>，用法参照上方<code>output.filename</code>。</p>
<h2 id="加载样式文件">加载样式文件</h2>
<p>如果不是写<code>lib</code>库，那<code>css</code>对于前端来说是必不可少的，对于<code>webpack</code>来说一切皆模块，我们只需要在<code>loader</code>中定义好<code>css</code>支持，即可引入<code>css</code>文件。</p>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span> <span class="token string">'css-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上面使用了<code>css-loader</code>来解析<code>css</code>模块生成代码文件，<code>style-loader</code>将生成的代码自动嵌入到<code>html</code>。但是这样有个问题，<code>css</code>文件无法使用缓存，我们需要将生成的<code>css</code>代码抽出到一个<code>bundle</code>中。<code>mini-css-extract-plugin</code>插件就能帮助我们完成这个任务。</p>
<pre><code class="language-js"><span class="token keyword">const</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">'style/[name]-[contenthash:5].css'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">chunkFilename</span><span class="token operator">:</span> <span class="token string">'style/[name]-[chunkhash:5].css'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>其中创建<code>mini-css-extract-plugin</code>实例的参数的<code>filename</code>和<code>chunkFilename</code>可配置的值与<code>output.filename</code>是一样的。<code>filename</code>表示输出非按需加载的<code>chunk</code>中<code>css</code>的<code>bundle</code>，<code>chunkFilename</code>表示输出按需加载的<code>chunk</code>中<code>css</code>的<code>bundle</code>。</p>
<h3 id="开启css模块">开启css模块</h3>
<p>我们知道开发大部分时候<code>css</code>选择器是根据类名去匹配元素的，如果工程比较大多人开发，或者有两个组件使用了一个相同的类名，后者就会把前者的样式给覆盖掉，为了解决这个问题产生出了<code>CSS</code>模块化概念。</p>
<p>其实<code>css-loader</code>已经内置了模块化功能，在默认情况下，<code>css-loader</code>会用<code>/\.module\.\w+$/i.test(filename)</code>匹配文件名，如果匹配上了就开启模块化。也就是说我们的<code>css</code>文件名以<code>module.css</code>结尾即可开启模块化。开启模块化的<code>css</code>文件，模块中 <em>（css文件）</em> 每个类选择器和id选择器都会替换成<code>hash</code>名称，如果我们不需要替换可以使用<code>:global()</code>来包裹住不需要替换的选择器。</p>
<pre><code class="language-css"><span class="token comment">/* login.module.css 打包前 */</span>
<span class="token selector"><span class="token class">.name</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.user-age</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#pwd</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.user</span> <span class="token class">.age</span> div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.user</span> <span class="token pseudo-class">:global</span><span class="token punctuation">(</span><span class="token class">.age</span><span class="token punctuation">)</span> div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 打包后 */</span>
<span class="token selector"><span class="token class">.ah4VvUCzdSHinav53q40</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.M7m9Yez7JZkfnGJZgkWc</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#UB1EFfX0F7izHsHajHV8</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.Oos422SahRxya3J3gTZ7</span> <span class="token class">.cs0aFUaAnLU8hThBYcPk</span> div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.Oos422SahRxya3J3gTZ7</span> <span class="token class">.age</span> div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>由于打包后的名称会更改，无法引用，所以我们使用时需要换一种使用方式。使用<code>css-loader</code>为我们生成的对象来引用名称。</p>
<pre><code class="language-js"><span class="token keyword module">import</span> <span class="token imports">style</span> <span class="token keyword module">from</span> <span class="token string">'../style/login.module.css'</span>

<span class="token keyword">const</span> $app <span class="token operator">=</span> documnet<span class="token punctuation">.</span><span class="token method function property-access">querySelect</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

$app<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>名称：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>style<span class="token punctuation">.</span><span class="token property-access">name</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>年龄：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>style<span class="token punctuation">[</span><span class="token string">'user-age'</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
</span><span class="token template-punctuation string">`</span></span>
</code></pre>
<h4 id="优化模块化">优化模块化</h4>
<p>虽然上面开启了模块化，但是我们需要对其进行优化，给<code>css-loader</code>传入参数</p>
<ul>
<li>在使用默认的配置下模块化的<code>css</code>只会产生一个默认对象，来引用所有生成名称，如果我们想用<code>es5 module</code>需要将<code>namedExport</code>属性改为<code>true</code>。</li>
<li>使用默认的name生成方式非常难调试，因为生成名称基本上没有阅读性。我们需要自定义生成名称，需要自定义<code>localIdentName</code>属性，<code>localIdentName</code>也是字符串模板，下面列出可支持使用模板：<ul>
<li>[name] 源文件名称</li>
<li>[folder] 文件夹相对于<code>compiler.context</code>或者<code>modules.localIdentContext</code>配置项的相对路径。</li>
<li>[path] 源文件相对于<code>compiler.context</code>或者<code>modules.localIdentContext</code>配置项的相对路径。</li>
<li>[file] - 文件名和路径。</li>
<li>[ext] - 文件拓展名。</li>
<li>[hash] - 字符串的哈希值。基于<code>localIdentHashSalt</code>、<code>localIdentHashFunction</code>、<code>localIdentHashDigest</code>、<code>localIdentHashDigestLength</code>、<code>localIdentContext</code>、<code>resourcePath</code>和<code>exportName</code>生成。</li>
<li>[local] - 原始类名。</li>
</ul>
</li>
<li>编写<code>css</code>文件时一般采用<code>-</code>来代替驼峰命名，我们需要将<code>-</code>转化为驼峰，需要将<code>exportLocalsConvention</code>属性改为<code>camelCaseOnly</code></li>
</ul>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.css</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token comment">// 模块化定制</span>
              <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token comment">// 更改模块化导出的样式名称 使用文件名称加原始类名加hash</span>
                <span class="token literal-property property">localIdentName</span><span class="token operator">:</span> <span class="token string">'[name]__[local]--[hash:base64:5]'</span><span class="token punctuation">,</span>
                <span class="token comment">// 驼峰化对象，并保留原始key 比如 userAge user-age都可用</span>
                <span class="token literal-property property">exportLocalsConvention</span><span class="token operator">:</span> <span class="token string">'camelCaseOnly'</span><span class="token punctuation">,</span>
                <span class="token comment">// 启用es5 模块</span>
                <span class="token literal-property property">namedExport</span><span class="token operator">:</span> <span class="token boolean">true</span>
              <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>接下来我们看看更换后打包结果，</p>
<pre><code class="language-css"><span class="token selector"><span class="token class">.login-module__name--ah4Vv</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.login-module__user-age--M7m9Y</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token id">#login-module__pwd--UB1EF</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.login-module__user--Oos42</span> <span class="token class">.login-module__age--cs0aF</span> div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector"><span class="token class">.login-module__user--Oos42</span> <span class="token class">.age</span> div</span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>使用方式</p>
<pre><code class="language-js"><span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> name<span class="token punctuation">,</span> userAge <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">'../style/login.module.css'</span>

<span class="token keyword">const</span> $app <span class="token operator">=</span> documnet<span class="token punctuation">.</span><span class="token method function property-access">querySelect</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

$app<span class="token punctuation">.</span><span class="token property-access">innerHTML</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token html language-html">
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>名称：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">></span></span>年龄：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>userAge<span class="token interpolation-punctuation punctuation">}</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">></span></span>
</span><span class="token template-punctuation string">`</span></span>
</code></pre>
<h3 id="使用scss、less">使用scss、less</h3>
<p>要使用<code>scss</code>或<code>less</code>就首先要把这两种预处理语言转化成<code>css</code>语言，<code>scss</code>使用<code>node-sass</code>库来转化，而<code>less</code>则是使用<code>less</code>库。转化成功后要将结果给到<code>webpack</code>使用，我们可以使用<code>sass-loader</code>和<code>less-loader</code>来完成这个工作。我们看看怎么集成</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> --save-dev less-loader <span class="token function">less</span>
<span class="token function">npm</span> <span class="token function">install</span> --save-dev sass-loader node-sass
</code></pre>
<pre><code class="language-js"><span class="token keyword">const</span> cssRuleLoader <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">localIdentName</span><span class="token operator">:</span> <span class="token string">'[name]__[local]--[hash:base64:5]'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exportLocalsConvention</span><span class="token operator">:</span> <span class="token string">'camelCaseOnly'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">namedExport</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.less</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token spread operator">...</span>cssRuleLoader<span class="token punctuation">,</span>
          <span class="token string">'less-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.scss</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token spread operator">...</span>cssRuleLoader<span class="token punctuation">,</span>
          <span class="token string">'sass-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>scss</code>和<code>less</code>同样也可以开启模块化，我们前面说了只要符合<code>/\.module\.\w+$/i.test(filename)</code>即可，所以我们只需将文件名改为<code>login.module.scss</code>或<code>login.module.less</code>即可开启模块化。</p>
<h3 id="使用postcss">使用PostCSS</h3>
<p><code>PostCSS</code>是一个<code>CSS</code>处理工具，它通过插件机制可以灵活的扩展其支持的特性。目前用法最广泛的就是为<code>CSS</code>自动添加厂商前缀、使用下一代<code>CSS</code>语法，然后转化为现代浏览器能识别的语法，这个工作可以借助<code>postcss</code>的<code>postcss-preset-env</code>插件完成。使用时需要将样式内容传入<code>postcss</code>库，然后将生成的内容提供给<code>webpack</code>，需要使用<code>postcss-loader</code>完成这一工作。</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> --save-dev postcss-loader postcss postcss-preset-env
</code></pre>
<pre><code class="language-js"><span class="token keyword">const</span> cssRuleLoader <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">localIdentName</span><span class="token operator">:</span> <span class="token string">'[name]__[local]--[hash:base64:5]'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exportLocalsConvention</span><span class="token operator">:</span> <span class="token string">'camelCaseOnly'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">namedExport</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在传入webpack前需要先使用postcss转化</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'post-loader'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// postss需要使用的插件</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 数组，第一个使用插件，第二个参数</span>
        <span class="token punctuation">[</span>
          <span class="token string">'postcss-preset-env'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">stage</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'> 0.2%'</span><span class="token punctuation">,</span>
              <span class="token string">'ie > 10'</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p><code>stage</code>决定哪些<code>css</code>特性需要被<code>polyfill</code>，他们的值分别代表</p>
<ul>
<li>0 非官方草案</li>
<li>1 编辑草案或早期工作草案</li>
<li>2 工作草案</li>
<li>3 候选版本</li>
<li>4 推荐标准</li>
</ul>
<p><code>browsers</code>来配置需要支持的浏览器环境，其中数据和是否需要加前缀是根据<a href="https://caniuse.com/">caniuse</a>决定的。<a href="https://github.com/browserslist/browserslist#queries">查看的更多browsers定义规则</a></p>
<h3 id="import处理">@import处理</h3>
<p>如果我们使用上方的配置在样式文件中使用<code>@import</code>导入其他样式文件时会有出乎预料情况发生。我们看看打包情况</p>
<pre><code class="language-scss"><span class="token comment">/* ------------打包前------------- */</span>
<span class="token comment">/* base.scss */</span>
<span class="token selector">* </span><span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.user </span><span class="token punctuation">{</span>
  <span class="token selector">.name </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#12312312</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
   <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">:fullscreen </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* login.scss */</span>
<span class="token keyword">@import</span> <span class="token url">url</span><span class="token punctuation">(</span><span class="token string">'./base.scss'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token selector">.name </span><span class="token punctuation">{</span>
  <span class="token selector">.age </span><span class="token punctuation">{</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#12312312</span><span class="token punctuation">;</span>
    <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token punctuation">:</span><span class="token function">global</span><span class="token punctuation">(</span>.age<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">:fullscreen </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* ---------------------------- */</span>


<span class="token comment">/* ------------打包后------------- */</span>
<span class="token selector">* </span><span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.base__user--VIoKM </span><span class="token punctuation">{</span>
  <span class="token selector">.base__name--BOmiJ </span><span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#12312312</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
   <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">:fullscreen </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token selector">.home-module__name--x_p3i .home-module__age--jCPqC </span><span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">0.07059</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">.age </span><span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">:-webkit-full-screen </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">:-ms-fullscreen </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector">:fullscreen </span><span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>


<span class="token comment">/* ---------------------------- */</span>
</code></pre>
<p>我们看到被<code>@import</code>进来的样式文件样式开启了模块化，证明它经过了<code>css-loader</code>处理。但是并有将<code>scss</code>转化为<code>css</code>，该添加的前缀也被加，并没有被<code>postcss-loader</code>和<code>scss-loader</code>处理。这是因为<code>@import</code>是在<code>css-loader</code>中处理的，默认导入的<code>css</code>只从当前<code>loader</code>开始处理，然后流向下一个<code>loader</code>。</p>
<p><code>css-loader</code>有一个参数可以定义一个参数来配置由<code>@import</code>进来的文件如何处理，<code>importLoaders</code>设置在<code>css-loader</code>之前应用的<code>loader</code>的数量。上方的情况在<code>css-loader</code>之前还需要应用到<code>postcss-loader</code>和<code>scss-loader</code>所以应该设置为2。</p>
<pre><code class="language-js"><span class="token keyword">const</span> cssRuleLoader <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span> <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token maybe-class-name">MiniCssExtractPlugin</span><span class="token punctuation">.</span><span class="token property-access">loader</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">importLoaders</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      <span class="token literal-property property">modules</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">localIdentName</span><span class="token operator">:</span> <span class="token string">'[name]__[local]--[hash:base64:5]'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">exportLocalsConvention</span><span class="token operator">:</span> <span class="token string">'camelCaseOnly'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">namedExport</span><span class="token operator">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 在传入webpack前需要先使用postcss转化</span>
  <span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'post-loader'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token comment">// postss需要使用的插件</span>
      <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token comment">// 数组，第一个使用插件，第二个参数</span>
        <span class="token punctuation">[</span>
          <span class="token string">'postcss-preset-env'</span><span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">stage</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
            <span class="token literal-property property">browsers</span><span class="token operator">:</span> <span class="token punctuation">[</span>
              <span class="token string">'> 0.2%'</span><span class="token punctuation">,</span>
              <span class="token string">'ie > 10'</span>
            <span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
</code></pre>
<p>更改配置后的打包结果就正常了：</p>
<pre><code class="language-css"><span class="token selector">*</span> <span class="token punctuation">{</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">padding</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">border</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.base__user--VIoKM</span></span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  <span class="token selector"><span class="token class">.base__user--VIoKM</span> <span class="token class">.base__name--BOmiJ</span></span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">0.07059</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token pseudo-class">:-webkit-full-screen</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token pseudo-class">:-ms-fullscreen</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token pseudo-class">:fullscreen</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.home-module__name--x_p3i</span> <span class="token class">.home-module__age--jCPqC</span></span> <span class="token punctuation">{</span>
  <span class="token property">background</span><span class="token punctuation">:</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">49</span><span class="token punctuation">,</span><span class="token number">35</span><span class="token punctuation">,</span><span class="token number">0.07059</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token class">.age</span></span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span> -ms-flexbox<span class="token punctuation">;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token pseudo-class">:-webkit-full-screen</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token pseudo-class">:-ms-fullscreen</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token selector"><span class="token pseudo-class">:fullscreen</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
</code></pre>
<h2 id="使用ts">使用ts</h2>
<p><code>TypeScript</code>是<code>JavaScript</code>的一个超集，主要提供了类型检查系统和对最新特性语法的支持。首先需要一个将<code>ts</code>编译成<code>js</code>的编译器<code>typescript</code>，然后将它集成到<code>webpack</code>中，使用<code>ts-loader</code>。</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> --save-dev typescript ts-loader
</code></pre>
<p>我们还需要一个配置编译选项文件告诉<code>typescript</code>如何编译它，编译器默认会读取和使用在当前项目根目录下的<code>tsconfig.json</code>文件。</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES2016"</span><span class="token punctuation">,</span>
    <span class="token property">"incremental"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"tsBuildInfoFile"</span><span class="token operator">:</span> <span class="token string">"./node_modules/ts-cache"</span><span class="token punctuation">,</span>
    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"rootDir"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/**/*.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>然后我们需要在<code>webpack</code>中声明<code>ts</code>文件的处理</p>
<pre><code class="language-js"><span class="token keyword">const</span> <span class="token function-variable function">jsUseLoader</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
  <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">presets</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token function">jsUseLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span> 
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.tsx?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">jsUseLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ts-loader'</span><span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 允许使用ts为后缀的模块</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.ts'</span><span class="token punctuation">,</span> <span class="token string">'.tsx'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="tsconfigjson">tsconfig.json</h3>
<p>下面是这个<code>tsconfig.json</code>文件的常用配置及说明：</p>
<pre><code class="language-js"><span class="token punctuation">{</span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* -----------------------基本选项----------------------- */</span>

    <span class="token comment">// 开启增量编译：TS 编译器在第一次编译的时候，会生成一个存储编译信息的文件，下一次编译的时候，会根据这个文件进行增量的编译，以此提高 TS 的编译速度 </span>
    <span class="token string-property property">"incremental"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 指定存储增量编译信息的文件位置</span>
    <span class="token string-property property">"tsBuildInfoFile"</span><span class="token operator">:</span> <span class="token string">"./node_modules/ts-cache"</span><span class="token punctuation">,</span>

    <span class="token comment">// 控制编译后输出的是什么js版本，默认值为es3。</span>
    <span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token string">"es2016"</span><span class="token punctuation">,</span>

    <span class="token comment">// 指定要引入的库文件，默认值为 target === 'ES6' ? [DOM，ES6，DOM.Iterable，ScriptHost] : [DOM，ES5，ScriptHost]</span>
    <span class="token comment">// 可选值有   </span>
    <span class="token comment">//  JavaScript 功能: es5 es6 es2015 es7 es2016 es2017 esnext</span>
    <span class="token comment">//  运行环境： dom dom.iterable webworker scripthost</span>
    <span class="token comment">//  ESNext功能选项: es2015.core es2015.collection es2015.generator es2015.iterable es2015.promise </span>
    <span class="token comment">//                 es2015.proxy es2015.reflect es2015.symbol es2015.symbol.wellknown es2016.array.include </span>
    <span class="token comment">//                 es2017.object es2017.sharedmemory esnext.asynciterable</span>
    <span class="token string-property property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"esnext"</span><span class="token punctuation">,</span> <span class="token string">"dom"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 是否对js文件进行编译，默认false</span>
    <span class="token string-property property">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 报告 javascript 文件中的错误</span>
    <span class="token string-property property">"checkJs"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 指定jsx代码用于的开发环境:'preserve','react-native',or 'react</span>
    <span class="token comment">// 'react' 模式下：TS 会直接把 jsx 编译成 js</span>
    <span class="token comment">// 'preserve' 模式下：TS 不会把 jsx 编译成 js，会保留 jsx</span>
    <span class="token string-property property">"jsx"</span><span class="token operator">:</span> <span class="token string">"preserve"</span><span class="token punctuation">,</span>

    <span class="token comment">// 生成相应的 '.d.ts' 文件</span>
    <span class="token string-property property">"declaration"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 生成相应的 '.map' 文件</span>
    <span class="token string-property property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 是否生成sourceMap，默认false</span>
    <span class="token string-property property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 将输出文件合并为一个文件</span>
    <span class="token string-property property">"outFile"</span><span class="token operator">:</span> <span class="token string">"./"</span>

    <span class="token comment">// 输入文件的根目录</span>
    <span class="token string-property property">"rootDir"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>

    <span class="token comment">// 指定编译结果的输出目录的，默认是将编译结果输出文件输出到源文件目录下</span>
    <span class="token string-property property">"outDir"</span><span class="token operator">:</span> <span class="token string">"dist"</span><span class="token punctuation">,</span>

    <span class="token comment">// 删除注释</span>
    <span class="token string-property property">"removeComments"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">/* -----------------------模块解析处理----------------------- */</span>

    <span class="token comment">// 支持使用es模块引入commonjs包，并让ts默认处理</span>
    <span class="token string-property property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 指定类型声明文件的查找路径。默认值为node_modules/@types</span>
    <span class="token string-property property">"typeRoots"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'node_modules/@types'</span><span class="token punctuation">,</span> <span class="token string">'./typings'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 配合typeRoots使用，指定需要包含的模块，只有在这里列出的模块的声明文件才会被加载进来</span>
    <span class="token string-property property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jest"</span><span class="token punctuation">,</span> <span class="token string">"node"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>

    <span class="token comment">// 拓宽引入非相对模块时的查找路径的。其默认值就是"./"，</span>
    <span class="token comment">// 如果找不到模块还会到baseUrl中指定的目录下查找</span>
    <span class="token string-property property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>

    <span class="token comment">// 配合baseUrl一起使用的，用于到baseUrl所在目录下指定的路径映射。</span>
    <span class="token string-property property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">"@"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 指定要使用的模块标准，如果不显式配置module，那么其值与target的配置有关，其默认值为target === "es3" or "es5" ?"commonjs" : "es6"</span>
    <span class="token comment">// 'None', 'CommonJS', 'AMD', 'System', 'UMD', 'ES6'/'ES2015', 'ES2020' or 'ESNext'</span>
    <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>

    <span class="token comment">// 模块的解析规则，默认值为 module ==="amd" or "system" or "es6" or "es2015"? "classic" : "node"</span>
    <span class="token comment">// classic </span>
    <span class="token comment">//    对于相对路径模块: 只会在当前相对路径下查找是否存在该文件(.ts文件)</span>
    <span class="token comment">//    非相对路径模块: 编译器则会从包含导入文件的目录开始依次向上级目录遍历，尝试定位匹配的ts文件或者d.ts类型声明文件</span>
    <span class="token comment">// node</span>
    <span class="token comment">//    对于相对路径模块:除了会在当前相对路径下查找是否存在该文件(.ts文件)外，还会作进一步的解析，如果在相对目录下没有找到对应的.ts文件，</span>
    <span class="token comment">//      那么就会看一下是否存在同名的目录，如果有，那么再看一下里面是否有package.json文件，然后看里面有没有配置，main属性，如果配置了，</span>
    <span class="token comment">//      则加载main所指向的文件(.ts或者.d.ts),如果没有配置main属性，那么就会看一下目录里有没有index.ts或者index.d.ts，有则加载。</span>
    <span class="token comment">//    对于非相对路径模块: 对于非相对路径模块，那么会直接到a.ts所在目录下的node_modules目录下去查找，也是遵循逐层遍历的规则，查找规则同上</span>
    <span class="token string-property property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>

    <span class="token comment">// 允许导入.json文件</span>
    <span class="token string-property property">"resolveJsonModule"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">/* -----------------------模块解析处理----------------------- */</span>

    <span class="token comment">// 开启全局严格检查，默认false</span>
    <span class="token string-property property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 是否检查检查未使用的局部变量，默认false</span>
    <span class="token string-property property">"noUnusedLocals"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 不允许使用隐式的 any 类型</span>
    <span class="token string-property property">"noImplicitAny"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 不允许把 null、undefined 赋值给其他类型变量</span>
    <span class="token string-property property">"strictNullChecks"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 不允许函数参数双向协变 如下方将不被允许</span>
    <span class="token comment">// type fn = (a: number) => void  </span>
    <span class="token comment">// let a: number | string </span>
    <span class="token comment">// fn(a) </span>
    <span class="token string-property property">"strictFunctionTypes"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 使用 bind/call/apply 时，严格检查函数参数类型</span>
    <span class="token string-property property">"strictBindCallApply"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 有未使用到的函数参数时报错</span>
    <span class="token string-property property">"noUnusedParameters"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 不允许 switch 的 case 语句贯穿</span>
    <span class="token string-property property">"noFallthroughCasesInSwitch"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">/* -----------------------其他选项----------------------- */</span>

    <span class="token comment">// 开启装饰器特性</span>
    <span class="token string-property property">"experimentalDecorators"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 给源码里的装饰器声明加上设计类型元数据。</span>
    <span class="token string-property property">"emitDecoratorMetadata"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

    <span class="token comment">// 开启使用Object.defineProperty替换class声明中的字段</span>
    <span class="token string-property property">"useDefineForClassFields"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>

  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 编译包含的源文件</span>
  <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/"</span><span class="token punctuation">]</span>

  <span class="token comment">// 需要排除的源文件</span>
  <span class="token string-property property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'src/test'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>更全配置参考<a href="https://www.tslang.cn/docs/handbook/compiler-options.html">官网</a>，接下来就要接入<code>webpack</code></p>
<h3 id="导入静态资源文件">导入静态资源文件</h3>
<p><code>webpack</code>一切皆模块可以在<code>js</code>中导入如<code>png、css</code>等文件在<code>loader</code>中解析，但是<code>ts</code>并不认识这些文件，如果不做处理直接引入会导致<code>ts</code>编译失败。我们需要对这些模块类型声明，<code>ts</code>并不处理这些模块，在转译成<code>js</code>后在<code>webpack</code>处理即可。</p>
<p>接下来我们声明一份<code>global.d.ts</code>然后将它放到源码根目录，<code>ts</code>就可以识别到他们了。</p>
<pre><code class="language-js"><span class="token comment">// global.d.ts</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.svg'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.png'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.jpg'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.jpeg'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.gif'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.bmp'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.tiff'</span>

<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.css'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.sass'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.scss'</span>
<span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.less'</span>
</code></pre>
<h3 id="vscode-ts支持模块化css">vscode ts支持模块化css</h3>
<p>上方的类型声明只是让<code>ts</code>支持这些模块的导入，如果我们使用<code>模块化css</code>无法检测导入变量是否正确，也无法享受<code>ts</code>的提示，为了解决这个我们可以使用<code>typescript</code>的<code>typescript-plugin-css-modules</code>插件。首先我们需要安装它</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span>  --save-dev typescript-plugin-css-modules
</code></pre>
<p>我们需要修改<code>tsconfig.json</code>来引用这个插件</p>
<pre><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"module"</span><span class="token operator">:</span> <span class="token string">"ESNext"</span><span class="token punctuation">,</span>
    <span class="token property">"target"</span><span class="token operator">:</span> <span class="token string">"ES2016"</span><span class="token punctuation">,</span>
    <span class="token property">"incremental"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"tsBuildInfoFile"</span><span class="token operator">:</span> <span class="token string">"./node_modules/ts-cache"</span><span class="token punctuation">,</span>
    <span class="token property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token property">"rootDir"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>
    <span class="token property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"./"</span><span class="token punctuation">,</span>
    <span class="token property">"plugins"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"typescript-plugin-css-modules"</span><span class="token punctuation">,</span>
        <span class="token property">"options"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token comment">// classname转化 与css-loader的exportLocalsConvention保持一致</span>
          <span class="token property">"classnameTransform"</span><span class="token operator">:</span> <span class="token string">"camelCaseOnly"</span><span class="token punctuation">,</span>
          <span class="token comment">// 启用es5模块 与 css-loader的namedExport保持一致</span>
          <span class="token property">"namedExports"</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/**/*.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<p>因为这个插件并不是针对真正<code>ts</code>编译的，而是针对<code>vscode</code>编辑器的，所以我们还需要将编辑器的当前使用的<code>TypeScript</code>的版本改成当前工作区版本。</p>
<ul>
<li>随意打开一个<code>ts</code>文件</li>
<li>点击底部<code>{} Typescript</code>选择版本</li>
<li>选择使用工作区版本</li>
</ul>
<p><img src="/article/46492e8d9418d7f0ad08/./image/css-model-ts.png" alt="css-module-ts.png"></p>
<p>选择后如果没生效重启<code>vscode</code>因为有可能有缓存。然后就可以看到效果了</p>
<p><img src="/article/46492e8d9418d7f0ad08/./image/css-module-tip.png" alt="css-module-tip.png"></p>
<h3 id="ts-快捷路径访问模块">ts 快捷路径访问模块</h3>
<p>我们在<code>webpack</code>建立的快捷路径访问模块，<code>typescript</code>并不认识它，除了在<code>webpack.config.js</code>建立外，我们还需要在<code>tsconfig.json</code>中配置快捷路径访问模块，而且两者配置规则不太一样</p>
<pre><code class="language-json">  <span class="token property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">"@ui/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"packages/components/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"@sdk/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"packages/sdk/*"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token property">"~sdkConfig"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"packages/sdk/config/default.json"</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>如果可能我们应该尽可能只保留一份配置文件，这样方便管理，我们保留<code>tsconfig.json</code>版本，然后写一个函数来生成<code>webpack</code>的<code>resolve.alias</code>。我们可以用<code>convert-tsconfig-paths-to-webpack-aliases</code>包来做这件事。</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> --save-dev convert-tsconfig-paths-to-webpack-aliases
</code></pre>
<pre><code class="language-js"><span class="token keyword">const</span> tsconfigPathToAlias <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'convert-tsconfig-paths-to-webpack-aliases'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword module">default</span>
<span class="token keyword">const</span> tsconfig <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./tsconfig.json'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> aliass <span class="token operator">=</span> <span class="token function">tsconfigPathToAlias</span><span class="token punctuation">(</span>tsconfig<span class="token punctuation">)</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">alias</span><span class="token operator">:</span> aliass
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="使用ejs">使用ejs</h2>
<p>在没有使用<code>vue</code>或<code>react</code>等框架提供方便模板和<code>jsx</code>环境下编写项目下，编写<code>html</code>可能会显得比较吃力，我们可以使用一些模板来替代它们的工作，这里介绍一下<code>ejs</code>如何集成到<code>webpack</code>。</p>
<p>要将<code>ejs</code>如何集成到<code>webpack</code>首先要使用<code>ejs-loader</code>，然后再<code>loader</code>预设。</p>
<pre><code class="language-shell"><span class="token function">npm</span> <span class="token function">install</span> --save-dev ejs-loader
</code></pre>
<pre><code class="language-js">module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">.ejs$</span><span class="token regex-delimiter">/</span></span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules|bower_compunents</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">'ejs-loader'</span><span class="token punctuation">,</span>
          <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token comment">// 因为ejs使用了with语法，在esModule模式下会禁止使用，直接报错</span>
            <span class="token literal-property property">esModule</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>然后我们在<code>js</code>的模块中就可以使用它们了，如果是<code>ts</code>则还需要为这类模块进行声明。</p>
<pre><code class="language-js"><span class="token keyword">declare</span> <span class="token keyword">module</span> <span class="token string">'*.ejs'</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token function-variable function">EjsTemplate</span><span class="token operator">:</span> <span class="token punctuation">(</span>args<span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token punctuation">[</span>key <span class="token keyword">in</span> <span class="token builtin">string</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">any</span> <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token builtin">string</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> EjsTemplate
<span class="token punctuation">}</span>
</code></pre>
<p>到这里<code>webpack5</code>的基础知识我们就讲完了，下一章我们说说如何优化开发环境，使<code>webpack</code>能更快的构建本地应用，并充分利用编译缓存。</p>
</div></div><div class="style_article-loading-layer__3poja"><div class="style_layer__GxMiF"><div style="fill:var(--vice-color);height:64px;width:64px"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
  <circle transform="translate(8 0)" cx="0" cy="16" r="0"> 
    <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0"
      keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8" calcMode="spline" />
  </circle>
  <circle transform="translate(16 0)" cx="0" cy="16" r="0"> 
    <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0.3"
      keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8" calcMode="spline" />
  </circle>
  <circle transform="translate(24 0)" cx="0" cy="16" r="0"> 
    <animate attributeName="r" values="0; 4; 0; 0" dur="1.2s" repeatCount="indefinite" begin="0.6"
      keytimes="0;0.2;0.7;1" keySplines="0.2 0.2 0.4 0.8;0.2 0.6 0.4 0.8;0.2 0.6 0.4 0.8" calcMode="spline" />
  </circle>
</svg>
</div></div></div> </div><div class="style_bottom__29qYA"><p>©2021 - bill-lai 的小站 -<a rel="noreferrer" href="https://github.com/bill-lai/bill-lai.github.io" target="_blank">站点源码</a></p><p>本站使用<a rel="noreferrer" target="_blank" href="https://react.docschina.org/docs/hooks-reference.html#usememo">ReactHook</a><a rel="noreferrer" target="_blank" href="https://www.typescriptlang.org/zh/">TypeScript</a><a rel="noreferrer" target="_blank" href="https://docs.github.com/cn/rest">githubAPI</a><a rel="noreferrer" target="_blank" href="https://simplemde.com/">SimpleMDE</a>制作</p></div></div><div class="style_right-layer__Rm9TS "><div class="style_right__3hdcL"><div class="style_right-content__F68mu"><div class="navigation"><h4 class="style_title__1aA1F">目录列表</h4><ul class="style_top-navs__3vyAr"><li class=""><span>chunk<!-- --> <i class="iconfont icon-arrow_down"></i></span><ul class="style_child-navs__6paad"><li class=""><span>entry 产生的 chunk<!-- --> </span></li><li class=""><span>按需加载（异步）产生的 chunk<!-- --> </span></li><li class=""><span>代码分隔产生的 chunk<!-- --> </span></li></ul></li><li class=""><span>bundle<!-- --> </span></li><li class=""><span>entry 和 context<!-- --> </span></li><li class=""><span>output<!-- --> <i class="iconfont icon-arrow_down"></i></span><ul class="style_child-navs__6paad"><li class=""><span>filename 和 chunkFilename<!-- --> </span></li><li class=""><span>path<!-- --> </span></li></ul></li><li class=""><span>html 自动引入 bundle 文件<!-- --> <i class="iconfont icon-arrow_down"></i></span><ul class="style_child-navs__6paad"><li class=""><span>定制 html<!-- --> </span></li><li class=""><span>多页面<!-- --> </span></li><li class=""><span>cdn 加速和缓存处理<!-- --> </span></li><li class=""><span>扩展<!-- --> </span></li></ul></li><li class=""><span>抽取公用代码<!-- --> </span></li><li class=""><span>使用非模块化库<!-- --> </span></li><li class=""><span>快捷路径访问模块<!-- --> </span></li><li class=""><span>使用ES语法新特性<!-- --> <i class="iconfont icon-arrow_down"></i></span><ul class="style_child-navs__6paad"><li class=""><span>目标环境<!-- --> </span></li><li class=""><span>抽离转换代码<!-- --> </span></li><li class=""><span>开启编译缓存<!-- --> </span></li></ul></li><li class=""><span>资源模块管理<!-- --> </span></li><li class=""><span>加载样式文件<!-- --> <i class="iconfont icon-arrow_down"></i></span><ul class="style_child-navs__6paad"><li class=""><span>开启css模块<!-- --> </span><ul class="style_child-navs__6paad"><li class=""><span>优化模块化<!-- --> </span></li></ul></li><li class=""><span>使用scss、less<!-- --> </span></li><li class=""><span>使用PostCSS<!-- --> </span></li><li class=""><span>@import处理<!-- --> </span></li></ul></li><li class=""><span>使用ts<!-- --> <i class="iconfont icon-arrow_down"></i></span><ul class="style_child-navs__6paad"><li class=""><span>tsconfig.json<!-- --> </span></li><li class=""><span>导入静态资源文件<!-- --> </span></li><li class=""><span>vscode ts支持模块化css<!-- --> </span></li><li class=""><span>ts 快捷路径访问模块<!-- --> </span></li></ul></li><li class=""><span>使用ejs<!-- --> </span></li></ul></div></div></div></div></div></div></div></div>
          <script>var globalState = {"article/46492e8d9418d7f0ad08":{"title":"webpack5基础知识","id":"46492e8d9418d7f0ad08","mtime":1648476196354,"ctime":1648475898905,"issues":{"number":30,"commentsUrl":"https://api.github.com/repos/bill-lai/bill-lai.github.io/issues/30/comments","reactionsUrl":"https://api.github.com/repos/bill-lai/bill-lai.github.io/issues/30/reactions"},"head":null,"foot":null,"dirs":[{"leave":2,"title":"chunk","children":[{"leave":3,"title":"entry 产生的 chunk","children":[]},{"leave":3,"title":"按需加载（异步）产生的 chunk","children":[]},{"leave":3,"title":"代码分隔产生的 chunk","children":[]}]},{"leave":2,"title":"bundle","children":[]},{"leave":2,"title":"entry 和 context","children":[]},{"leave":2,"title":"output","children":[{"leave":3,"title":"filename 和 chunkFilename","children":[]},{"leave":3,"title":"path","children":[]}]},{"leave":2,"title":"html 自动引入 bundle 文件","children":[{"leave":3,"title":"定制 html","children":[]},{"leave":3,"title":"多页面","children":[]},{"leave":3,"title":"cdn 加速和缓存处理","children":[]},{"leave":3,"title":"扩展","children":[]}]},{"leave":2,"title":"抽取公用代码","children":[]},{"leave":2,"title":"使用非模块化库","children":[]},{"leave":2,"title":"快捷路径访问模块","children":[]},{"leave":2,"title":"使用ES语法新特性","children":[{"leave":3,"title":"目标环境","children":[]},{"leave":3,"title":"抽离转换代码","children":[]},{"leave":3,"title":"开启编译缓存","children":[]}]},{"leave":2,"title":"资源模块管理","children":[]},{"leave":2,"title":"加载样式文件","children":[{"leave":3,"title":"开启css模块","children":[{"leave":4,"title":"优化模块化","children":[]}]},{"leave":3,"title":"使用scss、less","children":[]},{"leave":3,"title":"使用PostCSS","children":[]},{"leave":3,"title":"@import处理","children":[]}]},{"leave":2,"title":"使用ts","children":[{"leave":3,"title":"tsconfig.json","children":[]},{"leave":3,"title":"导入静态资源文件","children":[]},{"leave":3,"title":"vscode ts支持模块化css","children":[]},{"leave":3,"title":"ts 快捷路径访问模块","children":[]}]},{"leave":2,"title":"使用ejs","children":[]}],"body":"<blockquote>\n<p>注意，本文使用 webpack5.68.0，不同版本可能会有细微区别。</p>\n</blockquote>\n<p><a href=\"https://www.webpackjs.com/\">webpack</a>是一个模块化打包 JavaScript 的工具，在 Wepack 里一切文件皆模块，通过<code>Loader</code>翻译转化文件，通过<code>Plugin</code>注入钩子，最后输出多个模块组合的文件，而<code>Webpack</code>专注于构建模块化项目。官网的首页图说明了<code>Webpack</code>是什么：</p>\n<p><img src=\"/article/46492e8d9418d7f0ad08/./image/1-2webpack.png\" alt=\"webpack\"></p>\n<p>对于<code>webpack</code>的基础配置及概念可以从<a href=\"https://www.webpackjs.com/\">官网文档</a>中学习，本文列举<code>webpack</code>的在生产环境和开发环境中通用的<code>Plugin</code>和<code>Loader</code>及配置。</p>\n<p>本文后续会出现经常提及<code>chunk</code>和<code>bundle</code>在这里我们先解析一下这个概念</p>\n<h2 id=\"chunk\">chunk</h2>\n<p><code>chunk</code>从字面意思是代码块，在<code>Webpack</code>中<code>chunk</code>代表许多关联<code>module</code>的集合。比如在<code>webpack.config.js</code>声明了入口模块<code>entry</code>，入口模块又关联了其他模块，这一系列关联的模块就是一个<code>chunk</code>。</p>\n<p>在<code>webpack</code>中产生<code>chunk</code>有三种途径。</p>\n<h3 id=\"entry-产生的-chunk\">entry 产生的 chunk</h3>\n<p>在<code>webpack.config.js</code>中可以声明<code>entry</code>来指代入口模块，<code>entry</code>合法类型有<code>string | Array | object</code></p>\n<p><code>entry</code>字段值如果是<code>string | Array</code>会产生一个名为<code>main</code>的<code>chunk</code>；如果是<code>Array</code>则将数组里的源代码都打包到一个<code>chunk</code>中。如下：</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/main.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./src/main.js\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"./src/other.js\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>如果是一个对象，则会声明与<code>key</code>数量相同<code>chunk</code>，并且会使用<code>key</code>来作为<code>chunk</code>的名称。这就是为什么<code>entry</code>是对象，<code>output.filename</code>如果写死名称会直接报错的原因，因为一个名称不够让多个<code>chunk</code>输出。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token keyword module\">export</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">main</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/main.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">other</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/other.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./dist\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 会产生 main.js  other.js两个文件</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[name].js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"按需加载（异步）产生的-chunk\">按需加载（异步）产生的 chunk</h3>\n<p>按需加载（异步）加载的模块也会产生<code>chunk</code>，这个<code>chunk</code>名称可以在代码中使用<code>webpackChunkName</code>自行定义。如果需要打包的时候使用<code>chunk</code>名称，则需要在<code>output.chunkFilename</code>中引用。</p>\n<pre><code class=\"language-js\"><span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token keyword module\">export</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[name].js\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// module</span>\n<span class=\"token keyword module\">import</span><span class=\"token punctuation\">(</span><span class=\"token comment\">/* webpackChunkName: \"async-model\" */</span> <span class=\"token string\">\"./async-model\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"代码分隔产生的-chunk\">代码分隔产生的 chunk</h3>\n<p>在<code>webpack5</code>中代码分割使用<code>SplitChunksPlugin</code>插件实现，这个插件内置在<code>webpack</code>中，在使用时直接用配置的方式即可。代码分隔时也会产生<code>chunk</code>，我们用代码来说明一下：</p>\n<pre><code class=\"language-js\"><span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token keyword module\">export</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/a.js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/b.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">optimization</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 分隔webpack运行时代码</span>\n    <span class=\"token literal-property property\">runtimeChunk</span><span class=\"token operator\">:</span> <span class=\"token string\">\"single\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">splitChunks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 分隔组</span>\n      <span class=\"token literal-property property\">cacheGroups</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 抽取第三方模块</span>\n        <span class=\"token literal-property property\">vendors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">prioity</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">10</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">reuseExistingChunk</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 抽取</span>\n        <span class=\"token literal-property property\">commons</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">minSize</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 抽取的chunk最小大小</span>\n          <span class=\"token literal-property property\">minChunks</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 最小引用数</span>\n          <span class=\"token literal-property property\">prioity</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">reuseExistingChunk</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// a.js</span>\n<span class=\"token keyword module\">import</span> <span class=\"token string\">\"c.js\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">$</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">\"jquery\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span>$<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token comment\">// b.js</span>\n<span class=\"token keyword module\">import</span> <span class=\"token string\">\"c.js\"</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// commons.js</span>\n<span class=\"token console class-name\">console</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>上方代码使用了代码分隔，总共会产生 6 个<code>chunk</code></p>\n<ul>\n<li>两个入口分别分配到名为<code>a</code>和<code>b</code>的<code>chunk</code></li>\n<li><code>runtimeChunk</code>声明抽离<code>webpack</code>运行时代码抽离到一个唯一的名称的<code>chunk</code>，我们有两个入口，有两份运行时<code>chunk</code></li>\n<li><code>jquery</code>符合<code>cacheGroups.vendors</code>规则，抽离到名为<code>vendors</code>的<code>chunk</code></li>\n<li><code>commons.js</code>符合<code>cacheGroups.commons</code>规则，抽离到名为<code>commons</code>的<code>chunk</code></li>\n</ul>\n<p>如下图所示</p>\n<p><img src=\"/article/46492e8d9418d7f0ad08/./image/build.png\" alt=\"build\"></p>\n<h2 id=\"bundle\">bundle</h2>\n<p><code>bundle</code>就是我们最终输出的一个或多个文件，大多数情况下一个<code>chunk</code>至少会产生一个<code>bundle</code>，但是不完全是一对一的关系。比如我们在模块中引用图片又经过<code>url-loader</code>打包到外部；或者是引用了样式，通过<code>extract-text-webpack-plugin</code>抽离出来，这样一个<code>chunk</code>就会出现产生多个<code>bundle</code>的情况。</p>\n<p>简单来说<code>bundle</code>就是<code>chunk</code>在构建完成的呈现。</p>\n<h2 id=\"entry-和-context\">entry 和 context</h2>\n<p><code>entry</code>是<code>webpack</code>的启动模块入口，<code>webpack</code>将根据指定的这个起点来查找模块，生成<code>chunk</code>，<code>entry</code>的合法值有：</p>\n<ol>\n<li><code>string</code>，入口起点的模块路径，<code>webapck</code>将生成名为<code>main</code>的<code>chunk</code></li>\n<li><code>Array</code>，入口起点的一组模块的路径，<code>webpack</code>将组的中每个模块拼合在一起，并生成名为<code>main</code>的<code>chunk</code></li>\n<li><code>{ [key in string]: string | Array }</code>，多个入口起点，<code>webpack</code>根据<code>value</code> <em>（跟 1,2 合法值一致）</em>为入口起点，<code>key</code>为名称的<code>chunk</code>。</li>\n<li><code>function</code>，获取入口起点的方法，返回值为 1,2,3 或<code>Promise&lt;1,2,3&gt;</code>，我们可以指定动态入口。</li>\n</ol>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./app/entry1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"./app/entry2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./app/entry-a\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./app/entry-b1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"./app/entry-b2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token string\">\"./app/entry-a\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./app/entry-a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>我们看到上方代码的入口模块值都是相对路径，默认情况下<code>webpack</code>想以当前目录为基础路径来查找。我们可以通过<code>context</code>来更改基础路径。</p>\n<p><strong><code>webapck</code>查找<code>loader</code>和启动入口模块时，会以配置中的<code>context</code>为基础目录</strong>。下面我们来改上方代码</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./entry1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"./entry2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">a</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./entry-a\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">b</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"./entry-b1\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"./entry-b2\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token string\">\"./entry-a\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token function-variable function\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Promise</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">resolve</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"./entry-a\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// ...</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h2 id=\"output\">output</h2>\n<p>默认情况下<code>webpack</code>会在<code>dist</code>输出<code>chunk</code>生成的<code>bundle</code>，文件名就是<code>chunk</code>名称。</p>\n<h3 id=\"filename-和-chunkfilename\">filename 和 chunkFilename</h3>\n<p>我们可以通过<code>output.filename</code>来修改非按需加载<code>chunk</code>生产<code>bundle</code>的名称。<code>output.filename</code>的合法值有<code>string | (pathData: PathData) =&gt; string</code>，默认值为<code>[name].js</code>。</p>\n<p>如果我们的项目中只有一个非按需加载的<code>chunk</code>（几乎不存在），可以使用静态名称来定义生产的<code>bundle</code>名称，如果有多个<code>chunk</code>就不行了，因为多个<code>chunk</code>无法放到一个<code>bundle</code>中</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"bundle.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>我们可以使用<code>webpack</code>内提供的模板字符串来定义<code>bundle</code>文件名，下表列举了常用的模板字符串：</p>\n<table>\n<thead>\n<tr>\n<th>模板</th>\n<th>描述</th>\n<th>稳定性</th>\n</tr>\n</thead>\n<tbody><tr>\n<td>[name]</td>\n<td><code>chunk</code>的名称</td>\n<td>只要<code>chunk</code>名称不修改就不会变化</td>\n</tr>\n<tr>\n<td>[hash]</td>\n<td>根据所有<code>chunk</code>生成的<code>hash</code></td>\n<td>工程中某个<code>chunk</code>被修改就会引起变化</td>\n</tr>\n<tr>\n<td>[chunkhash]</td>\n<td>根据<code>chunk</code>生成的<code>hash</code>值</td>\n<td>某个<code>chunk</code>被修改，只会引起被修改<code>chunk</code>的<code>hash</code></td>\n</tr>\n<tr>\n<td>[contenthash]</td>\n<td>根据<code>bundle</code>内容内容产生的<code>hash</code></td>\n<td><code>chunk</code>中某个<code>bundle</code>被修改，只会引起被修改<code>bundle</code>的<code>hash</code></td>\n</tr>\n</tbody></table>\n<p>下面代码例举了如何使用模板。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">outpit</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 直接使用</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[name].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[hash].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[chunkhash].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[contenthash].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 组合使用</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[name]-[contenthash].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 限定hash位数</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[hash:5].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[contenthash:5].bundle.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>在使用<code>[hash]</code>时需要注意，因为它是所有<code>chunk</code>都共享的，所以直接用<code>[hash]</code>可能会引起错误，跟上方使用静态变量一样，多个<code>chunk</code>无法放置到一个<code>bundle</code>。</p>\n<p>前面我们讲解了<code>filename</code>的配置方式，它们对非按需加载（异步）的<code>chunk</code>生效，如果需要对按需加载的<code>chunk</code>配置，那就需要用到<code>outpit.chunkFilename</code>了，它和<code>filename</code>的使用方式是一样的，这里不在赘述。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">outpit</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[name].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[hash].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[chunkhash].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[hash:5].js\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"[contenthash:5].bundle.js\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"path\">path</h3>\n<p>默认情况下<code>webpack</code>会将打包的文件输出到<code>dist</code>文件夹中，我们可以通过配置<code>output.path</code>来更改输出目录。</p>\n<p>在<code>path</code>可以使用<code>[hash]</code>的模板字符串，因为每次文件修改后<code>hash</code>都不一样，很容易就能生成所有版本构建后代码文件。</p>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"path\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./dist-[hash]\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h2 id=\"html-自动引入-bundle-文件\">html 自动引入 bundle 文件</h2>\n<p>如果要实现缓存目的，可以使<code>hash</code>来输出<code>bundle</code>。由于每次打包后的<code>hash</code>都可能会更改，在<code>html</code>手动引入<code>bundle</code>很麻烦，我们可以借助<a href=\"https://github.com/jantimon/html-webpack-plugin\">html-webpack-plugin</a>插件来实现自动引入<code>bundle</code>。</p>\n<p><code>html-webpack-plugin</code>的使用方式非常简单，只需创建一个实例，放置到<code>plugins</code>中就会自动生成在<code>output.path</code>中生成一个默认的<code>html</code>，这个<code>html</code>将会自动引入所有<code>chunk</code>生成的<code>bundle</code>。接下来我们创建最一个简单的使用。</p>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">HtmlWebpackPlugin</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"html-webpack-plugin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<p>在创建<code>html-webpack-plugin</code>实例时可以传入许多参数，可以通过<a href=\"https://github.com/jantimon/html-webpack-plugin\">官方文档</a>了解，接下来我们看看最常用的几种定制。</p>\n<h3 id=\"定制-html\">定制 html</h3>\n<p><code>template</code>参数可以指定生成<code>html</code>的模板，我们可以在这个<code>html</code>中编写自己需要的东西。<br><code>filename</code>参数可以指定<code>html-webpack-plugin</code>将<code>html</code>输出到哪里，这个参数的配置方式跟<code>outpit.filename</code>一样。<br><code>minify</code>参数可以决定是否压缩<code>html</code>，在<code>production</code>模式下会自动为<code>true</code>。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"assets/template.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index.html\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">minify</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"多页面\">多页面</h3>\n<p>上面我们说的<code>html-webpack-plugin</code>会自动产生一个<code>html</code>并引入所有<code>chunk</code>，这很适合<code>SPA</code> <em>（单页面）</em> 开发。而<code>MPA</code>需要多个<code>html</code>，而且每个<code>html</code>需要的<code>chunk</code>也不一样，接下来我们看看这个插件是如何适配<code>MPA</code>开发的。</p>\n<p>一个<code>html-webpack-plugin</code>实例会生产输出一个<code>html</code>，多个实例就会生产输出多个<code>html</code>，只需要在<code>plugins</code>中添加多个实例即可。<code>html-webpack-plugin</code>中有个<code>chunks</code>参数来指定<code>html</code>要关联的所有<code>chunk</code>。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">content</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./src'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">entry</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">login</span><span class=\"token operator\">:</span> <span class=\"token string\">'./login.js'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">home</span><span class=\"token operator\">:</span> <span class=\"token string\">'./home.js'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">base</span><span class=\"token operator\">:</span> <span class=\"token string\">'./base.js'</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'assets/template.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'login.html'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'login'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'base'</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">//需要关联的所有chunk</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'assets/template.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'home.html'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'home'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'base'</span><span class=\"token punctuation\">]</span>  <span class=\"token comment\">//需要关联的所有chunk</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3 id=\"cdn-加速和缓存处理\">cdn 加速和缓存处理</h3>\n<p>如果我们把<code>bundle</code>都上传到了<code>cdn</code>上，就需要对打包后的资源引入路径进行修改，我们可以通过<code>publicPath</code>参数给我们指定资源的前缀路径。<br>使用<code>cdn</code>一般会产生缓存问题，如果你的<code>output.filename</code>没有使用<code>hash</code>那更新后的文件不会立即生效。我们可以使用<code>hash</code>参数给引入路径加上此次构建缓存。 <em>（更好的方式是使用 output.filename），因为如果使用构建缓存意味着每次更新所有缓存都会被刷新。</em></p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"assets/template.html\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">publicPath</span><span class=\"token operator\">:</span> <span class=\"token string\">\"//www.cdn.com\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">hash</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"login.html\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"base\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//需要关联的所有chunk</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<h3 id=\"扩展\">扩展</h3>\n<p><code>html-webpack-plugin</code>的<code>template</code>是使用<a href=\"https://ejs.bootcss.com/\">ejs 模板语言</a>。<code>html-webpack-plugin</code>注入了许多变量给模板使用，我们可以直接在模板内使用这些变量来自定义扩展我们的<code>html</code>。</p>\n<table>\n<thead>\n<tr>\n<th>变量</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody><tr>\n<td><code>htmlWebpackPlugin.options</code></td>\n<td>创建<code>HtmlWebpackPlugin</code>实例的参数</td>\n</tr>\n<tr>\n<td><code>htmlWebpackPlugin.files</code></td>\n<td><code>htmlWebpackPlugin</code>准备注入的<code>bundle</code>，如果<code>inject</code>为<code>true</code>则自动注入</td>\n</tr>\n<tr>\n<td><code>webpackConfig</code></td>\n<td><code>webpack</code>的配置</td>\n</tr>\n<tr>\n<td><code>compilation</code></td>\n<td><code>webpack</code>的<a href=\"https://webpack.docschina.org/api/compilation-object/#compilation-object-methods\">编译对象</a></td>\n</tr>\n</tbody></table>\n<p><code>htmlWebpackPlugin.files</code>的类型为</p>\n<pre><code class=\"language-ts\"><span class=\"token keyword\">type</span> <span class=\"token class-name\">File</span> <span class=\"token punctuation\">{</span>\n  publicPath<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  js<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  css<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  manifest<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  favicon<span class=\"token operator\">?</span><span class=\"token operator\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>接下来我们做个 demo，关闭<code>inject</code>,手动将<code>webpack</code>打包后的<code>css</code>和<code>js</code>都内联到<code>html</code>中：</p>\n<pre><code class=\"language-js\"><span class=\"token comment\">// webpack.config.js</span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">HtmlWebpackPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">template</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">join</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">\"assets/template.ejs\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">inject</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">title</span><span class=\"token operator\">:</span> <span class=\"token string\">'login'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">\"login.html\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"login\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"base\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">//需要关联的所有chunk</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n</code></pre>\n<pre><code class=\"language-ejs\"><span class=\"token comment\">&lt;!-- template.ejs --></span>\n<span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span> <span class=\"token attr-name\">lang</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>en<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">http-equiv</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>X-UA-Compatible<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>IE=edge<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1.0<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>title</span><span class=\"token punctuation\">></span></span> <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%=</span><span class=\"token language-javascript\"> htmlWebpackPlugin<span class=\"token punctuation\">.</span><span class=\"token property-access\">options</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">titlea</span> </span><span class=\"token delimiter punctuation\">%></span></span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>title</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%</span><span class=\"token language-javascript\"> <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>cssFile <span class=\"token keyword\">of</span> htmlWebpackPlugin<span class=\"token punctuation\">.</span><span class=\"token property-access\">files</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">css</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> </span><span class=\"token delimiter punctuation\">%></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>style</span><span class=\"token punctuation\">></span></span><span class=\"token style\"><span class=\"token language-css\">\n      <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%=</span><span class=\"token language-javascript\"> compilation<span class=\"token punctuation\">.</span><span class=\"token property-access\">assets</span><span class=\"token punctuation\">[</span>cssFile<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">substr</span><span class=\"token punctuation\">(</span>htmlWebpackPlugin<span class=\"token punctuation\">.</span><span class=\"token property-access\">files</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">publicPath</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </span><span class=\"token delimiter punctuation\">%></span></span>    \n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>style</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%</span><span class=\"token language-javascript\"> <span class=\"token punctuation\">}</span> </span><span class=\"token delimiter punctuation\">%></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n\n  <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%</span><span class=\"token language-javascript\"> <span class=\"token keyword control-flow\">for</span> <span class=\"token punctuation\">(</span>jsFile <span class=\"token keyword\">of</span> htmlWebpackPlugin<span class=\"token punctuation\">.</span><span class=\"token property-access\">files</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">js</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span> </span><span class=\"token delimiter punctuation\">%></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n      <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%=</span><span class=\"token language-javascript\"> compilation<span class=\"token punctuation\">.</span><span class=\"token property-access\">assets</span><span class=\"token punctuation\">[</span>jsFile<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">substr</span><span class=\"token punctuation\">(</span>htmlWebpackPlugin<span class=\"token punctuation\">.</span><span class=\"token property-access\">files</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">publicPath</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">length</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">source</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> </span><span class=\"token delimiter punctuation\">%></span></span>    \n    </span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token ejs language-ejs\"><span class=\"token delimiter punctuation\">&lt;%</span><span class=\"token language-javascript\"> <span class=\"token punctuation\">}</span> </span><span class=\"token delimiter punctuation\">%></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span>\n</code></pre>\n<h2 id=\"抽取公用代码\">抽取公用代码</h2>\n<p><code>SplitChunksPlugin</code>是改进<code>CommonsChunkPlugin</code>而重新设计和实现的代码分片插件。<code>SplitChunksPlugin</code>可以配置式的定义如何抽取<code>chunk</code>，这是个十分有用的功能。</p>\n<ul>\n<li>例如有一个模块被两个入口模块引用，默认情况下这个公用模块在两个<code>chunk</code>都会有，默认情况下生成的两个<code>bundle</code>都会包含这个公用模块的内容，我们可以通过<code>SplitChunksPlugin</code>将公用模块单独抽成一个<code>chunk</code>，生成三个<code>bundle</code>，两个入口<code>bundle</code>引用这个公用的<code>bundle</code>。</li>\n<li>第三方库 <em>(通常在<code>node_modules</code>)</em> 通常情况下是不怎么会有大的变动的，为了充分利用缓存，我们可以把项目业务的代码和第三方库代码分成两个<code>chunk</code>，生成两份<code>bundle</code>，这样我们修改业务代码，第三方库的代码并不会变动，也就能利用上缓存了。 <em>(需要将output.filename修改成[chunkhash|contenthash].js)</em></li>\n</ul>\n<p>在默认情况下，<code>webpack</code>只会分片按需加载 <em>（只针对import(...)异步加载）</em> 的<code>chunks</code>。影响范围是在<code>optimization.splitChunks.chunks</code>中声明的，他们分别表示：</p>\n<ul>\n<li><code>initial</code>只影响入口<code>chunk</code>关联</li>\n<li><code>async</code> <em>（默认）</em> 只影响按需加载的<code>chunk</code></li>\n<li><code>all</code> 入口和按需加载都影响</li>\n</ul>\n<p>默认情况下的提取规则及主要配置代码：</p>\n<ul>\n<li><code>chunk</code>被多次引用或是来自<code>node_modules</code></li>\n<li><code>js chunk</code>体积大于30K</li>\n<li><code>css chunk</code>体积大于50K</li>\n<li>按需加载并行数小于等于5 （同时间import(...)的数量）</li>\n<li>首次加载并行数小于等于3（在html初次加载的 script引用数量）</li>\n</ul>\n<pre><code class=\"language-js\"><span class=\"token comment\">// splitChunks 默认配置</span>\n<span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// 工作于哪里 async initial（只对入口的chunk生效） all： async + all</span>\n  <span class=\"token literal-property property\">chunks</span><span class=\"token operator\">:</span> <span class=\"token string\">'async'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 体积小于多少提取</span>\n  <span class=\"token literal-property property\">minSize</span><span class=\"token operator\">:</span> <span class=\"token number\">20000</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// 另一种方式，指定模块类型</span>\n  <span class=\"token comment\">// minSize: {</span>\n  <span class=\"token comment\">//   javascript: 300000,</span>\n  <span class=\"token comment\">//   style: 500000</span>\n  <span class=\"token comment\">// },</span>\n\n  <span class=\"token comment\">// 最少被多少个chunk使用</span>\n  <span class=\"token literal-property property\">minChunks</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 按需加载并行数最小值</span>\n  <span class=\"token literal-property property\">maxAsyncRequests</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 首次加载最大并行数</span>\n  <span class=\"token literal-property property\">maxInitialRequests</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span>\n\n  <span class=\"token comment\">// 名称分隔符如模块A被chunk B和chunk C同时引用名称可能是default~B~C</span>\n  <span class=\"token literal-property property\">automaticNameDelimiter</span><span class=\"token operator\">:</span> <span class=\"token string\">'~'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 根据影响范围返回自动生成名称，比如 vendors~app1~app2.js</span>\n  <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// 上方是公用配置，可以自定义组配置，如果没有覆盖则会集成上方配置</span>\n  <span class=\"token comment\">// key 为抽取后的chunk name</span>\n  <span class=\"token literal-property property\">cacheGroups</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 没覆盖的会继承上方配置，比如minChunks: 1,</span>\n    <span class=\"token literal-property property\">vendors</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">//  group 特有属性 提取第三方模块</span>\n      <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">[\\\\/]node_modules[\\\\/]</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 优先级，优先级会影响webpack选中哪个group</span>\n      <span class=\"token comment\">// 比如一个chunk即符合default规则也符合vendors规则，则查看优先级，哪个高用哪个</span>\n      <span class=\"token literal-property property\">priority</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">10</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token comment\">// 多次引用提取</span>\n    <span class=\"token keyword module\">default</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 最小被两个chunk引用</span>\n      <span class=\"token literal-property property\">minChunks</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 优先级</span>\n      <span class=\"token literal-property property\">prority</span><span class=\"token operator\">:</span> <span class=\"token operator\">-</span><span class=\"token number\">20</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>更多相关配置查看<a href=\"https://webpack.docschina.org/plugins/split-chunks-plugin/\">官网</a></p>\n<h2 id=\"使用非模块化库\">使用非模块化库</h2>\n<p>一些历史项目上有些第三方库不支持模块化，或者因为其他局限性不能模块化，只能全局导入。比如<code>jquery</code>如果使用模块化方式导入，有第三方的插件将找不到它，因为它们是直接用全局版本的。如果直接在全局上引用<code>jquery</code>是可以解决问题，但我们项目上良好的<code>ts</code>提示也没有了。我们可以使用<code>webpack</code>的<code>externals</code>属性来解决这类问题。</p>\n<p><code>externals</code>能放置将<code>import</code>的包打包到<code>bundle</code>中，而是在运行时根据配置找到我们声明的扩展依赖并使用它。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">externals</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// key 为我们import的包名， value 为全局中变量名</span>\n    <span class=\"token literal-property property\">jquery</span><span class=\"token operator\">:</span> <span class=\"token string\">'jQuery'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// 使用</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> ajax <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'jquery'</span>\n<span class=\"token keyword module\">import</span> <span class=\"token imports\">$</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'jquery'</span>\n\n<span class=\"token comment\">// 将会转化为 jQuery.ajax({ ... })</span>\n<span class=\"token function\">ajax</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token spread operator\">...</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// 将会转化为 jQuery('#app')</span>\n<span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span>\n</code></pre>\n<p>更多相关内容参考<a href=\"https://www.webpackjs.com/configuration/externals/\">官网</a></p>\n<h2 id=\"快捷路径访问模块\">快捷路径访问模块</h2>\n<p>如果我们的项目非常复杂而且项目路径比较深就可以考虑建立访问快捷路径，比如我们项目结构如下</p>\n<pre><code class=\"language-text\">project\n|---packages\n|-----components\n|-------assets\n|         1.png\n|-----sdk\n|-------config\n|         default.json\n|-----pro1\n|       main.js\n|-----pro2\n|   scripts\n|   webpack.config.js\n</code></pre>\n<p>在<code>main.js</code>中要访问<code>components</code>中的<code>1.png</code>就需要<code>import img from &#39;/packages/components/assets/1.png&#39;</code>，路径非常的长。为了解决这个问题我们可以使用<code>webpack</code>的<code>resplve.alias</code>。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">alias</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">'@ui'</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./packages/components'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token string-property property\">'@sdk'</span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./packages/sdk'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// 末尾用$标识精准匹配  只匹配 import '~sdkConfig'</span>\n      <span class=\"token comment\">// import '~sdkConfig/xxx'不会流向这里</span>\n      <span class=\"token string-property property\">'~sdkConfig<script>!function(e){function t(t){for(var n,o,i=t[0],c=t[1],l=t[2],s=0,p=[];s<i.length;s++)o=i[s],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(f&&f(t);p.length;)p.shift()();return u.push.apply(u,l||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(u.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={1:0},a={1:0},u=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[];o[e]?t.push(o[e]):0!==o[e]&&{4:1}[e]&&t.push(o[e]=new Promise((function(t,r){for(var n="static/css/"+({}[e]||e)+"."+{3:"31d6cfe0",4:"4422e775"}[e]+".chunk.css",a=i.p+n,u=document.getElementsByTagName("link"),c=0;c<u.length;c++){var l=(f=u[c]).getAttribute("data-href")||f.getAttribute("href");if("stylesheet"===f.rel&&(l===n||l===a))return t()}var s=document.getElementsByTagName("style");for(c=0;c<s.length;c++){var f;if((l=(f=s[c]).getAttribute("data-href"))===n||l===a)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||a,u=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");u.code="CSS_CHUNK_LOAD_FAILED",u.request=n,delete o[e],p.parentNode.removeChild(p),r(u)},p.href=a,document.getElementsByTagName("head")[0].appendChild(p)})).then((function(){o[e]=0})));var r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=a[e]=[t,n]}));t.push(r[2]=n);var u,c=document.createElement("script");c.charset="utf-8",c.timeout=120,i.nc&&c.setAttribute("nonce",i.nc),c.src=function(e){return i.p+"static/js/"+({}[e]||e)+"."+{3:"c6f781a0",4:"199baeb9"}[e]+".chunk.js"}(e);var l=new Error;u=function(t){c.onerror=c.onload=null,clearTimeout(s);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,r[1](l)}a[e]=void 0}};var s=setTimeout((function(){u({type:"timeout",target:c})}),12e4);c.onerror=c.onload=u,document.head.appendChild(c)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var c=this.webpackJsonpsource=this.webpackJsonpsource||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var f=l;r()}([])</script><script src="/static/js/2.b25e0f2c.chunk.js"></script><script src="/static/js/main.18e76180.chunk.js"></script></body></html></span><span class=\"token operator\">:</span> path<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolve</span><span class=\"token punctuation\">(</span>__dirname<span class=\"token punctuation\">,</span> <span class=\"token string\">'./packages/sdk/config/default.json'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>然后我们就可以直接使用<code>import img from &#39;@ui/assets/1.png&#39;</code>了。</p>\n<h2 id=\"使用es语法新特性\">使用ES语法新特性</h2>\n<p>在<code>ES6</code>发布以后，<code>TC39</code>规定每年都会发布新的版本。通常把<code>ES5</code>及其之前的版本统称做<code>ES5</code>。为了明确区分各个版本的内容，可以按照版本发布的时间进行描述，比如<code>ES2015</code>,<code>ES2016</code>。虽然目前部分浏览器都开始支持了，但由于各个浏览器标准支持不全，以及新特性支持没那么快，这导致在开发中不敢全面地使用新特性。</p>\n<p>通常我们需要给新的<code>API</code>注入<code>polyfill</code>或者把新的<code>ES6</code>语法用<code>ES5</code>来使用新特性，<code>babel</code>就可以方便的完成。</p>\n<p><code>Babel</code>是一个<code>JavaScript</code>编译器，能将新特性语法代码转为<code>ES5</code>代码，让你使用最新的语言特性而不用担心兼容性问题，并且可以通过插件机制根据需求灵活的扩展。在于<code>webpack</code>结合时需要使用<code>babel-loader</code>作为桥梁。</p>\n<p>在编写配置之前我们需要安装<code>babel</code>核心库<code>@babel/core</code>，<code>babel</code>各个新特性转换的库<code>@babel/preset-env</code>以及<code>babel-loader</code></p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span>  --save-dev @babel/core @babel/preset-env babel-loader\n</code></pre>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">model</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.js</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n              <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3 id=\"目标环境\">目标环境</h3>\n<p><code>preset-env</code>会根据你编写代码按需加载支持代码，在没有配置的情况下会转换<code>ES2015</code>及以上的所有特性。我们可以通过<code>targets</code>参数来传递需要打包的目标环境，<code>babel</code>会根据<a href=\"https://caniuse.com/\">caniuse</a>的数据来决定是否需要转换。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">model</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.js</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// 指定目标环境</span>\n            <span class=\"token literal-property property\">targets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token punctuation\">{</span>\n                  <span class=\"token comment\">// chrome: '90',</span>\n                  <span class=\"token comment\">// ie: 11</span>\n                  <span class=\"token comment\">// node: 'current',</span>\n                  <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'last 2 versions'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ie > 10'</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3 id=\"抽离转换代码\">抽离转换代码</h3>\n<p>默认情况下<code>babel</code>的所有转换代码都会直接内联到<code>js bundle</code>中，假如我们有多个<code>chunk</code>那每个<code>chunk</code>生成的<code>js bundle</code>都有转换代码，我们需要将他们统一抽离，减少<code>js bundle</code>的大小。我们可以使用<code>babel</code>提供的<code>@babel/plugin-transform-runtime</code>插件解决这一需求</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span>  --save-dev @babel/plugin-transform-runtime\n</code></pre>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">model</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.js</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">targets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'last 2 versions'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ie > 10'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/plugin-transform-runtime'</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3 id=\"开启编译缓存\">开启编译缓存</h3>\n<p><code>babel</code>转换是件耗时的事，我们可以通过<code>babel-loader</code>的<code>cacheDirectory</code>来开启缓存，不变动的文件没必要再次编译，加快编译。默认情况下缓存文件会存放在<code>node_modules/.cache</code>中。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">model</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.js</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">targets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'last 2 versions'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ie > 10'</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/plugin-transform-runtime'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">cacheDirectory</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"资源模块管理\">资源模块管理</h2>\n<p>资源模块是一种模块类型，它允许使用资源文件（字体，图标等）而无需配置额外。在<code>webpack5</code>中使用资源模块来代替<code>raw-loader</code>、<code>url-loader</code>、<code>file-loader</code>管理资源模块。</p>\n<p>资源模块类型总共有4中类型来替换这些<code>loader</code></p>\n<ul>\n<li><code>asset/resource</code> 发送一个单独的文件并导出<code>URL</code>。之前通过使用<code>file-loader</code>实现。</li>\n<li><code>asset/inline</code> 导出一个资源的<code>data URI</code>。之前通过使用<code>url-loader</code>实现。</li>\n<li><code>asset/source</code> 导出资源的源代码。之前通过使用<code>raw-loader</code>实现。</li>\n<li><code>asset</code> 在导出一个<code>data URI</code>和发送一个单独的文件之间自动选择，默认下小于<code>8k</code>的将视为<code>inline</code>。之前通过使用<code>url-loader</code>，并且配置资源体积限制实现。</li>\n</ul>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 模型文件，统一导出为 URL</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.(obj|mtl)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'asset/resource'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token comment\">// 覆盖outpit.assetModuleFilename 自定义导出bundle路径</span>\n        <span class=\"token literal-property property\">generator</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'static/model/[hash][ext]'</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 图片文件，如果大于 10KB将导出为URL否则内联源代码</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">\\.(png|jpg|gif)$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'asset'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">parser</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">dataUrlCondition</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">maxSize</span><span class=\"token operator\">:</span> <span class=\"token number\">10</span> <span class=\"token operator\">*</span> <span class=\"token number\">1024</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// svg比较特殊，没有指定要raw时用URL，指定时用源码，所以需要二选一rules</span>\n        <span class=\"token literal-property property\">oneOf</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.svg$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token comment\">// 匹配模块引用路径query是否有raw，如果有则返回源码 </span>\n            <span class=\"token comment\">// 如 import svg from 'a.svg?raw'</span>\n            <span class=\"token literal-property property\">resourceQuery</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">raw</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'asset/source'</span>\n          <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.svg$</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> <span class=\"token string\">'asset/resource'</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">output</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// 输出asset资源</span>\n      <span class=\"token literal-property property\">assetModuleFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">'images/[hash][ext]'</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><code>outpit.assetModuleFilename</code>和<code>generator.filename</code>与<code>output.filename</code>相同不过适用于<code>Asset Modules</code>，用法参照上方<code>output.filename</code>。</p>\n<h2 id=\"加载样式文件\">加载样式文件</h2>\n<p>如果不是写<code>lib</code>库，那<code>css</code>对于前端来说是必不可少的，对于<code>webpack</code>来说一切皆模块，我们只需要在<code>loader</code>中定义好<code>css</code>支持，即可引入<code>css</code>文件。</p>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.css</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'style-loader'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>上面使用了<code>css-loader</code>来解析<code>css</code>模块生成代码文件，<code>style-loader</code>将生成的代码自动嵌入到<code>html</code>。但是这样有个问题，<code>css</code>文件无法使用缓存，我们需要将生成的<code>css</code>代码抽出到一个<code>bundle</code>中。<code>mini-css-extract-plugin</code>插件就能帮助我们完成这个任务。</p>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token maybe-class-name\">MiniCssExtractPlugin</span> <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'mini-css-extract-plugin'</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.css</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">MiniCssExtractPlugin</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">loader</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'css-loader'</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token keyword\">new</span> <span class=\"token class-name\">MiniCssExtractPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">filename</span><span class=\"token operator\">:</span> <span class=\"token string\">'style/[name]-[contenthash:5].css'</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">chunkFilename</span><span class=\"token operator\">:</span> <span class=\"token string\">'style/[name]-[chunkhash:5].css'</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>其中创建<code>mini-css-extract-plugin</code>实例的参数的<code>filename</code>和<code>chunkFilename</code>可配置的值与<code>output.filename</code>是一样的。<code>filename</code>表示输出非按需加载的<code>chunk</code>中<code>css</code>的<code>bundle</code>，<code>chunkFilename</code>表示输出按需加载的<code>chunk</code>中<code>css</code>的<code>bundle</code>。</p>\n<h3 id=\"开启css模块\">开启css模块</h3>\n<p>我们知道开发大部分时候<code>css</code>选择器是根据类名去匹配元素的，如果工程比较大多人开发，或者有两个组件使用了一个相同的类名，后者就会把前者的样式给覆盖掉，为了解决这个问题产生出了<code>CSS</code>模块化概念。</p>\n<p>其实<code>css-loader</code>已经内置了模块化功能，在默认情况下，<code>css-loader</code>会用<code>/\\.module\\.\\w+$/i.test(filename)</code>匹配文件名，如果匹配上了就开启模块化。也就是说我们的<code>css</code>文件名以<code>module.css</code>结尾即可开启模块化。开启模块化的<code>css</code>文件，模块中 <em>（css文件）</em> 每个类选择器和id选择器都会替换成<code>hash</code>名称，如果我们不需要替换可以使用<code>:global()</code>来包裹住不需要替换的选择器。</p>\n<pre><code class=\"language-css\"><span class=\"token comment\">/* login.module.css 打包前 */</span>\n<span class=\"token selector\"><span class=\"token class\">.name</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.user-age</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token id\">#pwd</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.user</span> <span class=\"token class\">.age</span> div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.user</span> <span class=\"token pseudo-class\">:global</span><span class=\"token punctuation\">(</span><span class=\"token class\">.age</span><span class=\"token punctuation\">)</span> div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* 打包后 */</span>\n<span class=\"token selector\"><span class=\"token class\">.ah4VvUCzdSHinav53q40</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.M7m9Yez7JZkfnGJZgkWc</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token id\">#UB1EFfX0F7izHsHajHV8</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.Oos422SahRxya3J3gTZ7</span> <span class=\"token class\">.cs0aFUaAnLU8hThBYcPk</span> div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.Oos422SahRxya3J3gTZ7</span> <span class=\"token class\">.age</span> div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>由于打包后的名称会更改，无法引用，所以我们使用时需要换一种使用方式。使用<code>css-loader</code>为我们生成的对象来引用名称。</p>\n<pre><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\">style</span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'../style/login.module.css'</span>\n\n<span class=\"token keyword\">const</span> $app <span class=\"token operator\">=</span> documnet<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span>\n\n$app<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token html language-html\">\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>名称：<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>style<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>年龄：<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>style<span class=\"token punctuation\">[</span><span class=\"token string\">'user-age'</span><span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span>\n</span><span class=\"token template-punctuation string\">`</span></span>\n</code></pre>\n<h4 id=\"优化模块化\">优化模块化</h4>\n<p>虽然上面开启了模块化，但是我们需要对其进行优化，给<code>css-loader</code>传入参数</p>\n<ul>\n<li>在使用默认的配置下模块化的<code>css</code>只会产生一个默认对象，来引用所有生成名称，如果我们想用<code>es5 module</code>需要将<code>namedExport</code>属性改为<code>true</code>。</li>\n<li>使用默认的name生成方式非常难调试，因为生成名称基本上没有阅读性。我们需要自定义生成名称，需要自定义<code>localIdentName</code>属性，<code>localIdentName</code>也是字符串模板，下面列出可支持使用模板：<ul>\n<li>[name] 源文件名称</li>\n<li>[folder] 文件夹相对于<code>compiler.context</code>或者<code>modules.localIdentContext</code>配置项的相对路径。</li>\n<li>[path] 源文件相对于<code>compiler.context</code>或者<code>modules.localIdentContext</code>配置项的相对路径。</li>\n<li>[file] - 文件名和路径。</li>\n<li>[ext] - 文件拓展名。</li>\n<li>[hash] - 字符串的哈希值。基于<code>localIdentHashSalt</code>、<code>localIdentHashFunction</code>、<code>localIdentHashDigest</code>、<code>localIdentHashDigestLength</code>、<code>localIdentContext</code>、<code>resourcePath</code>和<code>exportName</code>生成。</li>\n<li>[local] - 原始类名。</li>\n</ul>\n</li>\n<li>编写<code>css</code>文件时一般采用<code>-</code>来代替驼峰命名，我们需要将<code>-</code>转化为驼峰，需要将<code>exportLocalsConvention</code>属性改为<code>camelCaseOnly</code></li>\n</ul>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.css</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n              <span class=\"token comment\">// 模块化定制</span>\n              <span class=\"token literal-property property\">modules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token comment\">// 更改模块化导出的样式名称 使用文件名称加原始类名加hash</span>\n                <span class=\"token literal-property property\">localIdentName</span><span class=\"token operator\">:</span> <span class=\"token string\">'[name]__[local]--[hash:base64:5]'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token comment\">// 驼峰化对象，并保留原始key 比如 userAge user-age都可用</span>\n                <span class=\"token literal-property property\">exportLocalsConvention</span><span class=\"token operator\">:</span> <span class=\"token string\">'camelCaseOnly'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token comment\">// 启用es5 模块</span>\n                <span class=\"token literal-property property\">namedExport</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n              <span class=\"token punctuation\">}</span>\n            <span class=\"token punctuation\">}</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>接下来我们看看更换后打包结果，</p>\n<pre><code class=\"language-css\"><span class=\"token selector\"><span class=\"token class\">.login-module__name--ah4Vv</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.login-module__user-age--M7m9Y</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token id\">#login-module__pwd--UB1EF</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.login-module__user--Oos42</span> <span class=\"token class\">.login-module__age--cs0aF</span> div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n<span class=\"token selector\"><span class=\"token class\">.login-module__user--Oos42</span> <span class=\"token class\">.age</span> div</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">width</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>使用方式</p>\n<pre><code class=\"language-js\"><span class=\"token keyword module\">import</span> <span class=\"token imports\"><span class=\"token punctuation\">{</span> name<span class=\"token punctuation\">,</span> userAge <span class=\"token punctuation\">}</span></span> <span class=\"token keyword module\">from</span> <span class=\"token string\">'../style/login.module.css'</span>\n\n<span class=\"token keyword\">const</span> $app <span class=\"token operator\">=</span> documnet<span class=\"token punctuation\">.</span><span class=\"token method function property-access\">querySelect</span><span class=\"token punctuation\">(</span><span class=\"token string\">'#app'</span><span class=\"token punctuation\">)</span>\n\n$app<span class=\"token punctuation\">.</span><span class=\"token property-access\">innerHTML</span> <span class=\"token operator\">=</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token html language-html\">\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>名称：<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>input</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>name<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span><span class=\"token punctuation\">></span></span>年龄：<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>select</span> <span class=\"token attr-name\">class</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>userAge<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>select</span><span class=\"token punctuation\">></span></span>\n</span><span class=\"token template-punctuation string\">`</span></span>\n</code></pre>\n<h3 id=\"使用scss、less\">使用scss、less</h3>\n<p>要使用<code>scss</code>或<code>less</code>就首先要把这两种预处理语言转化成<code>css</code>语言，<code>scss</code>使用<code>node-sass</code>库来转化，而<code>less</code>则是使用<code>less</code>库。转化成功后要将结果给到<code>webpack</code>使用，我们可以使用<code>sass-loader</code>和<code>less-loader</code>来完成这个工作。我们看看怎么集成</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev less-loader <span class=\"token function\">less</span>\n<span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev sass-loader node-sass\n</code></pre>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> cssRuleLoader <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">MiniCssExtractPlugin</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">loader</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">modules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">localIdentName</span><span class=\"token operator\">:</span> <span class=\"token string\">'[name]__[local]--[hash:base64:5]'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">exportLocalsConvention</span><span class=\"token operator\">:</span> <span class=\"token string\">'camelCaseOnly'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">namedExport</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.less</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token spread operator\">...</span>cssRuleLoader<span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'less-loader'</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.scss</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n          <span class=\"token spread operator\">...</span>cssRuleLoader<span class=\"token punctuation\">,</span>\n          <span class=\"token string\">'sass-loader'</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p><code>scss</code>和<code>less</code>同样也可以开启模块化，我们前面说了只要符合<code>/\\.module\\.\\w+$/i.test(filename)</code>即可，所以我们只需将文件名改为<code>login.module.scss</code>或<code>login.module.less</code>即可开启模块化。</p>\n<h3 id=\"使用postcss\">使用PostCSS</h3>\n<p><code>PostCSS</code>是一个<code>CSS</code>处理工具，它通过插件机制可以灵活的扩展其支持的特性。目前用法最广泛的就是为<code>CSS</code>自动添加厂商前缀、使用下一代<code>CSS</code>语法，然后转化为现代浏览器能识别的语法，这个工作可以借助<code>postcss</code>的<code>postcss-preset-env</code>插件完成。使用时需要将样式内容传入<code>postcss</code>库，然后将生成的内容提供给<code>webpack</code>，需要使用<code>postcss-loader</code>完成这一工作。</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev postcss-loader postcss postcss-preset-env\n</code></pre>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> cssRuleLoader <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">MiniCssExtractPlugin</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">loader</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">modules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">localIdentName</span><span class=\"token operator\">:</span> <span class=\"token string\">'[name]__[local]--[hash:base64:5]'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">exportLocalsConvention</span><span class=\"token operator\">:</span> <span class=\"token string\">'camelCaseOnly'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">namedExport</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 在传入webpack前需要先使用postcss转化</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'post-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// postss需要使用的插件</span>\n      <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// 数组，第一个使用插件，第二个参数</span>\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">'postcss-preset-env'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">stage</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n              <span class=\"token string\">'> 0.2%'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token string\">'ie > 10'</span>\n            <span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre>\n<p><code>stage</code>决定哪些<code>css</code>特性需要被<code>polyfill</code>，他们的值分别代表</p>\n<ul>\n<li>0 非官方草案</li>\n<li>1 编辑草案或早期工作草案</li>\n<li>2 工作草案</li>\n<li>3 候选版本</li>\n<li>4 推荐标准</li>\n</ul>\n<p><code>browsers</code>来配置需要支持的浏览器环境，其中数据和是否需要加前缀是根据<a href=\"https://caniuse.com/\">caniuse</a>决定的。<a href=\"https://github.com/browserslist/browserslist#queries\">查看的更多browsers定义规则</a></p>\n<h3 id=\"import处理\">@import处理</h3>\n<p>如果我们使用上方的配置在样式文件中使用<code>@import</code>导入其他样式文件时会有出乎预料情况发生。我们看看打包情况</p>\n<pre><code class=\"language-scss\"><span class=\"token comment\">/* ------------打包前------------- */</span>\n<span class=\"token comment\">/* base.scss */</span>\n<span class=\"token selector\">* </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.user </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.name </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token hexcode color\">#12312312</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n   <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:fullscreen </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* login.scss */</span>\n<span class=\"token keyword\">@import</span> <span class=\"token url\">url</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./base.scss'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token selector\">.name </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.age </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token hexcode color\">#12312312</span><span class=\"token punctuation\">;</span>\n    <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">:</span><span class=\"token function\">global</span><span class=\"token punctuation\">(</span>.age<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:fullscreen </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">/* ---------------------------- */</span>\n\n\n<span class=\"token comment\">/* ------------打包后------------- */</span>\n<span class=\"token selector\">* </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.base__user--VIoKM </span><span class=\"token punctuation\">{</span>\n  <span class=\"token selector\">.base__name--BOmiJ </span><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token hexcode color\">#12312312</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n   <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:fullscreen </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.home-module__name--x_p3i .home-module__age--jCPqC </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token color\"><span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">,</span><span class=\"token number\">49</span><span class=\"token punctuation\">,</span><span class=\"token number\">35</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.07059</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.age </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> -ms-flexbox<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:-webkit-full-screen </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:-ms-fullscreen </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">:fullscreen </span><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">/* ---------------------------- */</span>\n</code></pre>\n<p>我们看到被<code>@import</code>进来的样式文件样式开启了模块化，证明它经过了<code>css-loader</code>处理。但是并有将<code>scss</code>转化为<code>css</code>，该添加的前缀也被加，并没有被<code>postcss-loader</code>和<code>scss-loader</code>处理。这是因为<code>@import</code>是在<code>css-loader</code>中处理的，默认导入的<code>css</code>只从当前<code>loader</code>开始处理，然后流向下一个<code>loader</code>。</p>\n<p><code>css-loader</code>有一个参数可以定义一个参数来配置由<code>@import</code>进来的文件如何处理，<code>importLoaders</code>设置在<code>css-loader</code>之前应用的<code>loader</code>的数量。上方的情况在<code>css-loader</code>之前还需要应用到<code>postcss-loader</code>和<code>scss-loader</code>所以应该设置为2。</p>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> cssRuleLoader <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n  <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token maybe-class-name\">MiniCssExtractPlugin</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">loader</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'css-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token literal-property property\">importLoaders</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n      <span class=\"token literal-property property\">modules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">localIdentName</span><span class=\"token operator\">:</span> <span class=\"token string\">'[name]__[local]--[hash:base64:5]'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">exportLocalsConvention</span><span class=\"token operator\">:</span> <span class=\"token string\">'camelCaseOnly'</span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">namedExport</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token comment\">// 在传入webpack前需要先使用postcss转化</span>\n  <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'post-loader'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token comment\">// postss需要使用的插件</span>\n      <span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token comment\">// 数组，第一个使用插件，第二个参数</span>\n        <span class=\"token punctuation\">[</span>\n          <span class=\"token string\">'postcss-preset-env'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">stage</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">browsers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n              <span class=\"token string\">'> 0.2%'</span><span class=\"token punctuation\">,</span>\n              <span class=\"token string\">'ie > 10'</span>\n            <span class=\"token punctuation\">]</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">]</span>\n</code></pre>\n<p>更改配置后的打包结果就正常了：</p>\n<pre><code class=\"language-css\"><span class=\"token selector\">*</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">margin</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">padding</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">border</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token class\">.base__user--VIoKM</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> -ms-flexbox<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token selector\"><span class=\"token class\">.base__user--VIoKM</span> <span class=\"token class\">.base__name--BOmiJ</span></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">color</span><span class=\"token punctuation\">:</span> <span class=\"token color\"><span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">,</span><span class=\"token number\">49</span><span class=\"token punctuation\">,</span><span class=\"token number\">35</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.07059</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token pseudo-class\">:-webkit-full-screen</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token pseudo-class\">:-ms-fullscreen</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token pseudo-class\">:fullscreen</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> auto<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token class\">.home-module__name--x_p3i</span> <span class=\"token class\">.home-module__age--jCPqC</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">background</span><span class=\"token punctuation\">:</span> <span class=\"token color\"><span class=\"token function\">rgba</span><span class=\"token punctuation\">(</span><span class=\"token number\">18</span><span class=\"token punctuation\">,</span><span class=\"token number\">49</span><span class=\"token punctuation\">,</span><span class=\"token number\">35</span><span class=\"token punctuation\">,</span><span class=\"token number\">0.07059</span><span class=\"token punctuation\">)</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token class\">.age</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> -ms-flexbox<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">display</span><span class=\"token punctuation\">:</span> flex<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token pseudo-class\">:-webkit-full-screen</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token pseudo-class\">:-ms-fullscreen</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\"><span class=\"token pseudo-class\">:fullscreen</span></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">height</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span><span class=\"token unit\">px</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"使用ts\">使用ts</h2>\n<p><code>TypeScript</code>是<code>JavaScript</code>的一个超集，主要提供了类型检查系统和对最新特性语法的支持。首先需要一个将<code>ts</code>编译成<code>js</code>的编译器<code>typescript</code>，然后将它集成到<code>webpack</code>中，使用<code>ts-loader</code>。</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev typescript ts-loader\n</code></pre>\n<p>我们还需要一个配置编译选项文件告诉<code>typescript</code>如何编译它，编译器默认会读取和使用在当前项目根目录下的<code>tsconfig.json</code>文件。</p>\n<pre><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ESNext\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ES2016\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"incremental\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"tsBuildInfoFile\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/ts-cache\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sourceMap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"rootDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"include\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/**/*.ts\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"exclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>然后我们需要在<code>webpack</code>中声明<code>ts</code>文件的处理</p>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">jsUseLoader</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token arrow operator\">=></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'babel-loader'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">presets</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">[</span><span class=\"token string\">'@babel/preset-env'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.js</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token function\">jsUseLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> \n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.tsx?$</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token function\">jsUseLoader</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ts-loader'</span><span class=\"token punctuation\">]</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// 允许使用ts为后缀的模块</span>\n    <span class=\"token literal-property property\">extensions</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'.ts'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.tsx'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'.js'</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h3 id=\"tsconfigjson\">tsconfig.json</h3>\n<p>下面是这个<code>tsconfig.json</code>文件的常用配置及说明：</p>\n<pre><code class=\"language-js\"><span class=\"token punctuation\">{</span>\n  <span class=\"token string-property property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">/* -----------------------基本选项----------------------- */</span>\n\n    <span class=\"token comment\">// 开启增量编译：TS 编译器在第一次编译的时候，会生成一个存储编译信息的文件，下一次编译的时候，会根据这个文件进行增量的编译，以此提高 TS 的编译速度 </span>\n    <span class=\"token string-property property\">\"incremental\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 指定存储增量编译信息的文件位置</span>\n    <span class=\"token string-property property\">\"tsBuildInfoFile\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/ts-cache\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 控制编译后输出的是什么js版本，默认值为es3。</span>\n    <span class=\"token string-property property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es2016\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 指定要引入的库文件，默认值为 target === 'ES6' ? [DOM，ES6，DOM.Iterable，ScriptHost] : [DOM，ES5，ScriptHost]</span>\n    <span class=\"token comment\">// 可选值有   </span>\n    <span class=\"token comment\">//  JavaScript 功能: es5 es6 es2015 es7 es2016 es2017 esnext</span>\n    <span class=\"token comment\">//  运行环境： dom dom.iterable webworker scripthost</span>\n    <span class=\"token comment\">//  ESNext功能选项: es2015.core es2015.collection es2015.generator es2015.iterable es2015.promise </span>\n    <span class=\"token comment\">//                 es2015.proxy es2015.reflect es2015.symbol es2015.symbol.wellknown es2016.array.include </span>\n    <span class=\"token comment\">//                 es2017.object es2017.sharedmemory esnext.asynciterable</span>\n    <span class=\"token string-property property\">\"lib\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"esnext\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dom\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 是否对js文件进行编译，默认false</span>\n    <span class=\"token string-property property\">\"allowJs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 报告 javascript 文件中的错误</span>\n    <span class=\"token string-property property\">\"checkJs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 指定jsx代码用于的开发环境:'preserve','react-native',or 'react</span>\n    <span class=\"token comment\">// 'react' 模式下：TS 会直接把 jsx 编译成 js</span>\n    <span class=\"token comment\">// 'preserve' 模式下：TS 不会把 jsx 编译成 js，会保留 jsx</span>\n    <span class=\"token string-property property\">\"jsx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"preserve\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 生成相应的 '.d.ts' 文件</span>\n    <span class=\"token string-property property\">\"declaration\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 生成相应的 '.map' 文件</span>\n    <span class=\"token string-property property\">\"sourceMap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 是否生成sourceMap，默认false</span>\n    <span class=\"token string-property property\">\"sourceMap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 将输出文件合并为一个文件</span>\n    <span class=\"token string-property property\">\"outFile\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span>\n\n    <span class=\"token comment\">// 输入文件的根目录</span>\n    <span class=\"token string-property property\">\"rootDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 指定编译结果的输出目录的，默认是将编译结果输出文件输出到源文件目录下</span>\n    <span class=\"token string-property property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"dist\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 删除注释</span>\n    <span class=\"token string-property property\">\"removeComments\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">/* -----------------------模块解析处理----------------------- */</span>\n\n    <span class=\"token comment\">// 支持使用es模块引入commonjs包，并让ts默认处理</span>\n    <span class=\"token string-property property\">\"esModuleInterop\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 指定类型声明文件的查找路径。默认值为node_modules/@types</span>\n    <span class=\"token string-property property\">\"typeRoots\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'node_modules/@types'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'./typings'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 配合typeRoots使用，指定需要包含的模块，只有在这里列出的模块的声明文件才会被加载进来</span>\n    <span class=\"token string-property property\">\"types\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"jest\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"node\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 拓宽引入非相对模块时的查找路径的。其默认值就是\"./\"，</span>\n    <span class=\"token comment\">// 如果找不到模块还会到baseUrl中指定的目录下查找</span>\n    <span class=\"token string-property property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\".\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 配合baseUrl一起使用的，用于到baseUrl所在目录下指定的路径映射。</span>\n    <span class=\"token string-property property\">\"paths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token string-property property\">\"@\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token comment\">// 指定要使用的模块标准，如果不显式配置module，那么其值与target的配置有关，其默认值为target === \"es3\" or \"es5\" ?\"commonjs\" : \"es6\"</span>\n    <span class=\"token comment\">// 'None', 'CommonJS', 'AMD', 'System', 'UMD', 'ES6'/'ES2015', 'ES2020' or 'ESNext'</span>\n    <span class=\"token string-property property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"esnext\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 模块的解析规则，默认值为 module ===\"amd\" or \"system\" or \"es6\" or \"es2015\"? \"classic\" : \"node\"</span>\n    <span class=\"token comment\">// classic </span>\n    <span class=\"token comment\">//    对于相对路径模块: 只会在当前相对路径下查找是否存在该文件(.ts文件)</span>\n    <span class=\"token comment\">//    非相对路径模块: 编译器则会从包含导入文件的目录开始依次向上级目录遍历，尝试定位匹配的ts文件或者d.ts类型声明文件</span>\n    <span class=\"token comment\">// node</span>\n    <span class=\"token comment\">//    对于相对路径模块:除了会在当前相对路径下查找是否存在该文件(.ts文件)外，还会作进一步的解析，如果在相对目录下没有找到对应的.ts文件，</span>\n    <span class=\"token comment\">//      那么就会看一下是否存在同名的目录，如果有，那么再看一下里面是否有package.json文件，然后看里面有没有配置，main属性，如果配置了，</span>\n    <span class=\"token comment\">//      则加载main所指向的文件(.ts或者.d.ts),如果没有配置main属性，那么就会看一下目录里有没有index.ts或者index.d.ts，有则加载。</span>\n    <span class=\"token comment\">//    对于非相对路径模块: 对于非相对路径模块，那么会直接到a.ts所在目录下的node_modules目录下去查找，也是遵循逐层遍历的规则，查找规则同上</span>\n    <span class=\"token string-property property\">\"moduleResolution\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node\"</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 允许导入.json文件</span>\n    <span class=\"token string-property property\">\"resolveJsonModule\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">/* -----------------------模块解析处理----------------------- */</span>\n\n    <span class=\"token comment\">// 开启全局严格检查，默认false</span>\n    <span class=\"token string-property property\">\"strict\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 是否检查检查未使用的局部变量，默认false</span>\n    <span class=\"token string-property property\">\"noUnusedLocals\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 不允许使用隐式的 any 类型</span>\n    <span class=\"token string-property property\">\"noImplicitAny\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 不允许把 null、undefined 赋值给其他类型变量</span>\n    <span class=\"token string-property property\">\"strictNullChecks\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 不允许函数参数双向协变 如下方将不被允许</span>\n    <span class=\"token comment\">// type fn = (a: number) => void  </span>\n    <span class=\"token comment\">// let a: number | string </span>\n    <span class=\"token comment\">// fn(a) </span>\n    <span class=\"token string-property property\">\"strictFunctionTypes\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 使用 bind/call/apply 时，严格检查函数参数类型</span>\n    <span class=\"token string-property property\">\"strictBindCallApply\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 有未使用到的函数参数时报错</span>\n    <span class=\"token string-property property\">\"noUnusedParameters\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 不允许 switch 的 case 语句贯穿</span>\n    <span class=\"token string-property property\">\"noFallthroughCasesInSwitch\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">/* -----------------------其他选项----------------------- */</span>\n\n    <span class=\"token comment\">// 开启装饰器特性</span>\n    <span class=\"token string-property property\">\"experimentalDecorators\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 给源码里的装饰器声明加上设计类型元数据。</span>\n    <span class=\"token string-property property\">\"emitDecoratorMetadata\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n    <span class=\"token comment\">// 开启使用Object.defineProperty替换class声明中的字段</span>\n    <span class=\"token string-property property\">\"useDefineForClassFields\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n\n  <span class=\"token comment\">// 编译包含的源文件</span>\n  <span class=\"token string-property property\">\"include\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/\"</span><span class=\"token punctuation\">]</span>\n\n  <span class=\"token comment\">// 需要排除的源文件</span>\n  <span class=\"token string-property property\">\"exclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'src/test'</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>更全配置参考<a href=\"https://www.tslang.cn/docs/handbook/compiler-options.html\">官网</a>，接下来就要接入<code>webpack</code></p>\n<h3 id=\"导入静态资源文件\">导入静态资源文件</h3>\n<p><code>webpack</code>一切皆模块可以在<code>js</code>中导入如<code>png、css</code>等文件在<code>loader</code>中解析，但是<code>ts</code>并不认识这些文件，如果不做处理直接引入会导致<code>ts</code>编译失败。我们需要对这些模块类型声明，<code>ts</code>并不处理这些模块，在转译成<code>js</code>后在<code>webpack</code>处理即可。</p>\n<p>接下来我们声明一份<code>global.d.ts</code>然后将它放到源码根目录，<code>ts</code>就可以识别到他们了。</p>\n<pre><code class=\"language-ts\"><span class=\"token comment\">// global.d.ts</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.svg'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.png'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.jpg'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.jpeg'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.gif'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.bmp'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.tiff'</span>\n\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.css'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.sass'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.scss'</span>\n<span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.less'</span>\n</code></pre>\n<h3 id=\"vscode-ts支持模块化css\">vscode ts支持模块化css</h3>\n<p>上方的类型声明只是让<code>ts</code>支持这些模块的导入，如果我们使用<code>模块化css</code>无法检测导入变量是否正确，也无法享受<code>ts</code>的提示，为了解决这个我们可以使用<code>typescript</code>的<code>typescript-plugin-css-modules</code>插件。首先我们需要安装它</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span>  --save-dev typescript-plugin-css-modules\n</code></pre>\n<p>我们需要修改<code>tsconfig.json</code>来引用这个插件</p>\n<pre><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ESNext\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ES2016\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"incremental\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"tsBuildInfoFile\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./node_modules/ts-cache\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sourceMap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"rootDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"plugins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"typescript-plugin-css-modules\"</span><span class=\"token punctuation\">,</span>\n        <span class=\"token property\">\"options\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token comment\">// classname转化 与css-loader的exportLocalsConvention保持一致</span>\n          <span class=\"token property\">\"classnameTransform\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"camelCaseOnly\"</span><span class=\"token punctuation\">,</span>\n          <span class=\"token comment\">// 启用es5模块 与 css-loader的namedExport保持一致</span>\n          <span class=\"token property\">\"namedExports\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"include\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/**/*.ts\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"exclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>因为这个插件并不是针对真正<code>ts</code>编译的，而是针对<code>vscode</code>编辑器的，所以我们还需要将编辑器的当前使用的<code>TypeScript</code>的版本改成当前工作区版本。</p>\n<ul>\n<li>随意打开一个<code>ts</code>文件</li>\n<li>点击底部<code>{} Typescript</code>选择版本</li>\n<li>选择使用工作区版本</li>\n</ul>\n<p><img src=\"/article/46492e8d9418d7f0ad08/./image/css-model-ts.png\" alt=\"css-module-ts.png\"></p>\n<p>选择后如果没生效重启<code>vscode</code>因为有可能有缓存。然后就可以看到效果了</p>\n<p><img src=\"/article/46492e8d9418d7f0ad08/./image/css-module-tip.png\" alt=\"css-module-tip.png\"></p>\n<h3 id=\"ts-快捷路径访问模块\">ts 快捷路径访问模块</h3>\n<p>我们在<code>webpack</code>建立的快捷路径访问模块，<code>typescript</code>并不认识它，除了在<code>webpack.config.js</code>建立外，我们还需要在<code>tsconfig.json</code>中配置快捷路径访问模块，而且两者配置规则不太一样</p>\n<pre><code class=\"language-json\">  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"paths\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"@ui/*\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"packages/components/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"@sdk/*\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"packages/sdk/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"~sdkConfig\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"packages/sdk/config/default.json\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n</code></pre>\n<p>如果可能我们应该尽可能只保留一份配置文件，这样方便管理，我们保留<code>tsconfig.json</code>版本，然后写一个函数来生成<code>webpack</code>的<code>resolve.alias</code>。我们可以用<code>convert-tsconfig-paths-to-webpack-aliases</code>包来做这件事。</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev convert-tsconfig-paths-to-webpack-aliases\n</code></pre>\n<pre><code class=\"language-js\"><span class=\"token keyword\">const</span> tsconfigPathToAlias <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'convert-tsconfig-paths-to-webpack-aliases'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token keyword module\">default</span>\n<span class=\"token keyword\">const</span> tsconfig <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./tsconfig.json'</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">const</span> aliass <span class=\"token operator\">=</span> <span class=\"token function\">tsconfigPathToAlias</span><span class=\"token punctuation\">(</span>tsconfig<span class=\"token punctuation\">)</span>\n\nmodule<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// ...</span>\n  <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">alias</span><span class=\"token operator\">:</span> aliass\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<h2 id=\"使用ejs\">使用ejs</h2>\n<p>在没有使用<code>vue</code>或<code>react</code>等框架提供方便模板和<code>jsx</code>环境下编写项目下，编写<code>html</code>可能会显得比较吃力，我们可以使用一些模板来替代它们的工作，这里介绍一下<code>ejs</code>如何集成到<code>webpack</code>。</p>\n<p>要将<code>ejs</code>如何集成到<code>webpack</code>首先要使用<code>ejs-loader</code>，然后再<code>loader</code>预设。</p>\n<pre><code class=\"language-shell\"><span class=\"token function\">npm</span> <span class=\"token function\">install</span> --save-dev ejs-loader\n</code></pre>\n<pre><code class=\"language-js\">module<span class=\"token punctuation\">.</span><span class=\"token property-access\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">module</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">rules</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        <span class=\"token literal-property property\">test</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">.ejs$</span><span class=\"token regex-delimiter\">/</span></span>\n        <span class=\"token literal-property property\">exclude</span><span class=\"token operator\">:</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">node_modules|bower_compunents</span><span class=\"token regex-delimiter\">/</span></span><span class=\"token punctuation\">,</span>\n        <span class=\"token literal-property property\">use</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token literal-property property\">loader</span><span class=\"token operator\">:</span> <span class=\"token string\">'ejs-loader'</span><span class=\"token punctuation\">,</span>\n          <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token comment\">// 因为ejs使用了with语法，在esModule模式下会禁止使用，直接报错</span>\n            <span class=\"token literal-property property\">esModule</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n          <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>然后我们在<code>js</code>的模块中就可以使用它们了，如果是<code>ts</code>则还需要为这类模块进行声明。</p>\n<pre><code class=\"language-ts\"><span class=\"token keyword\">declare</span> <span class=\"token keyword\">module</span> <span class=\"token string\">'*.ejs'</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">EjsTemplate</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">(</span>args<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token punctuation\">[</span>key <span class=\"token keyword\">in</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">]</span><span class=\"token operator\">:</span> <span class=\"token builtin\">any</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token builtin\">string</span>\n  <span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> EjsTemplate\n<span class=\"token punctuation\">}</span>\n</code></pre>\n<p>到这里<code>webpack5</code>的基础知识我们就讲完了，下一章我们说说如何优化开发环境，使<code>webpack</code>能更快的构建本地应用，并充分利用编译缓存。</p>\n","desc":"注意，本文使用 webpack5.68.0，不同版本可能会有细微区别。\n\nwebpack是一个模块化打包 JavaScript 的工具，在 Wepack 里一切文件皆模块，通过Loader翻译转化文件，通过Plugin注入钩子，最后输出多个模块组合的文件，而Webpack专注于构建模块化项目。官网"}}</script><script>!function(e){function t(t){for(var n,o,i=t[0],c=t[1],l=t[2],s=0,p=[];s<i.length;s++)o=i[s],Object.prototype.hasOwnProperty.call(a,o)&&a[o]&&p.push(a[o][0]),a[o]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(f&&f(t);p.length;)p.shift()();return u.push.apply(u,l||[]),r()}function r(){for(var e,t=0;t<u.length;t++){for(var r=u[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(u.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},o={1:0},a={1:0},u=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.e=function(e){var t=[];o[e]?t.push(o[e]):0!==o[e]&&{4:1}[e]&&t.push(o[e]=new Promise((function(t,r){for(var n="static/css/"+({}[e]||e)+"."+{3:"31d6cfe0",4:"4422e775"}[e]+".chunk.css",a=i.p+n,u=document.getElementsByTagName("link"),c=0;c<u.length;c++){var l=(f=u[c]).getAttribute("data-href")||f.getAttribute("href");if("stylesheet"===f.rel&&(l===n||l===a))return t()}var s=document.getElementsByTagName("style");for(c=0;c<s.length;c++){var f;if((l=(f=s[c]).getAttribute("data-href"))===n||l===a)return t()}var p=document.createElement("link");p.rel="stylesheet",p.type="text/css",p.onload=t,p.onerror=function(t){var n=t&&t.target&&t.target.src||a,u=new Error("Loading CSS chunk "+e+" failed.\n("+n+")");u.code="CSS_CHUNK_LOAD_FAILED",u.request=n,delete o[e],p.parentNode.removeChild(p),r(u)},p.href=a,document.getElementsByTagName("head")[0].appendChild(p)})).then((function(){o[e]=0})));var r=a[e];if(0!==r)if(r)t.push(r[2]);else{var n=new Promise((function(t,n){r=a[e]=[t,n]}));t.push(r[2]=n);var u,c=document.createElement("script");c.charset="utf-8",c.timeout=120,i.nc&&c.setAttribute("nonce",i.nc),c.src=function(e){return i.p+"static/js/"+({}[e]||e)+"."+{3:"c6f781a0",4:"199baeb9"}[e]+".chunk.js"}(e);var l=new Error;u=function(t){c.onerror=c.onload=null,clearTimeout(s);var r=a[e];if(0!==r){if(r){var n=t&&("load"===t.type?"missing":t.type),o=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+o+")",l.name="ChunkLoadError",l.type=n,l.request=o,r[1](l)}a[e]=void 0}};var s=setTimeout((function(){u({type:"timeout",target:c})}),12e4);c.onerror=c.onload=u,document.head.appendChild(c)}return Promise.all(t)},i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/",i.oe=function(e){throw console.error(e),e};var c=this.webpackJsonpsource=this.webpackJsonpsource||[],l=c.push.bind(c);c.push=t,c=c.slice();for(var s=0;s<c.length;s++)t(c[s]);var f=l;r()}([])</script><script src="/static/js/2.b25e0f2c.chunk.js"></script><script src="/static/js/main.18e76180.chunk.js"></script></body></html>